(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Cesium~31348d80"],{dd7f:function(e,t,a){"use strict";var r=a("77af"),n=a("bd8d"),o=a("2f63"),s=a("7d62"),u=a("e42d"),i=a("daa2"),d=a("f845"),c=a("a894"),m=a("ac3b"),l=a("6ef5"),h=a("6dc0"),_=a("5770"),p=a("a913"),C=a("461c"),f=a("5950"),g=a("6f00"),T=a("30d2");function v(e){this._translucentMultipassSupport=!1,this._translucentMRTSupport=!1;var t=e.colorBufferFloat&&e.depthTexture;this._translucentMRTSupport=e.drawBuffers&&t,this._translucentMultipassSupport=!this._translucentMRTSupport&&t,this._opaqueFBO=void 0,this._opaqueTexture=void 0,this._depthStencilTexture=void 0,this._accumulationTexture=void 0,this._translucentFBO=void 0,this._alphaFBO=void 0,this._adjustTranslucentFBO=void 0,this._adjustAlphaFBO=void 0,this._opaqueClearCommand=new d["a"]({color:new n["a"](0,0,0,0),owner:this}),this._translucentMRTClearCommand=new d["a"]({color:new n["a"](0,0,0,1),owner:this}),this._translucentMultipassClearCommand=new d["a"]({color:new n["a"](0,0,0,0),owner:this}),this._alphaClearCommand=new d["a"]({color:new n["a"](1,1,1,1),owner:this}),this._translucentRenderStateCache={},this._alphaRenderStateCache={},this._compositeCommand=void 0,this._adjustTranslucentCommand=void 0,this._adjustAlphaCommand=void 0,this._viewport=new r["a"],this._rs=void 0,this._useScissorTest=!1,this._scissorRectangle=void 0,this._useHDR=!1}function S(e){e._accumulationTexture=e._accumulationTexture&&!e._accumulationTexture.isDestroyed()&&e._accumulationTexture.destroy(),e._revealageTexture=e._revealageTexture&&!e._revealageTexture.isDestroyed()&&e._revealageTexture.destroy()}function O(e){e._translucentFBO=e._translucentFBO&&!e._translucentFBO.isDestroyed()&&e._translucentFBO.destroy(),e._alphaFBO=e._alphaFBO&&!e._alphaFBO.isDestroyed()&&e._alphaFBO.destroy(),e._adjustTranslucentFBO=e._adjustTranslucentFBO&&!e._adjustTranslucentFBO.isDestroyed()&&e._adjustTranslucentFBO.destroy(),e._adjustAlphaFBO=e._adjustAlphaFBO&&!e._adjustAlphaFBO.isDestroyed()&&e._adjustAlphaFBO.destroy()}function w(e){S(e),O(e)}function x(e,t,a,r){S(e),e._accumulationTexture=new p["a"]({context:t,width:a,height:r,pixelFormat:u["a"].RGBA,pixelDatatype:l["a"].FLOAT});var n=new Float32Array(a*r*4);e._revealageTexture=new p["a"]({context:t,pixelFormat:u["a"].RGBA,pixelDatatype:l["a"].FLOAT,source:{arrayBufferView:n,width:a,height:r},flipY:!1})}function F(e,t){O(e);var a=i["a"].FRAMEBUFFER_COMPLETE,r=!0;if(e._translucentMRTSupport&&(e._translucentFBO=new m["a"]({context:t,colorTextures:[e._accumulationTexture,e._revealageTexture],depthStencilTexture:e._depthStencilTexture,destroyAttachments:!1}),e._adjustTranslucentFBO=new m["a"]({context:t,colorTextures:[e._accumulationTexture,e._revealageTexture],destroyAttachments:!1}),e._translucentFBO.status===a&&e._adjustTranslucentFBO.status===a||(O(e),e._translucentMRTSupport=!1)),!e._translucentMRTSupport){e._translucentFBO=new m["a"]({context:t,colorTextures:[e._accumulationTexture],depthStencilTexture:e._depthStencilTexture,destroyAttachments:!1}),e._alphaFBO=new m["a"]({context:t,colorTextures:[e._revealageTexture],depthStencilTexture:e._depthStencilTexture,destroyAttachments:!1}),e._adjustTranslucentFBO=new m["a"]({context:t,colorTextures:[e._accumulationTexture],destroyAttachments:!1}),e._adjustAlphaFBO=new m["a"]({context:t,colorTextures:[e._revealageTexture],destroyAttachments:!1});var n=e._translucentFBO.status===a,o=e._alphaFBO.status===a,s=e._adjustTranslucentFBO.status===a,u=e._adjustAlphaFBO.status===a;n&&o&&s&&u||(w(e),e._translucentMultipassSupport=!1,r=!1)}return r}v.prototype.update=function(e,t,a,n){if(this.isSupported()){this._opaqueFBO=a,this._opaqueTexture=a.getColorTexture(0),this._depthStencilTexture=a.depthStencilTexture;var s=this._opaqueTexture.width,u=this._opaqueTexture.height,i=this._accumulationTexture,d=!Object(o["a"])(i)||i.width!==s||i.height!==u||n!==this._useHDR;if(d&&x(this,e,s,u),Object(o["a"])(this._translucentFBO)&&!d||F(this,e)){this._useHDR=n;var c,m,l=this;Object(o["a"])(this._compositeCommand)||(c=new _["a"]({sources:[f["a"]]}),this._translucentMRTSupport&&c.defines.push("MRT"),m={u_opaque:function(){return l._opaqueTexture},u_accumulation:function(){return l._accumulationTexture},u_revealage:function(){return l._revealageTexture}},this._compositeCommand=e.createViewportQuadCommand(c,{uniformMap:m,owner:this})),Object(o["a"])(this._adjustTranslucentCommand)||(this._translucentMRTSupport?(c=new _["a"]({defines:["MRT"],sources:[C["a"]]}),m={u_bgColor:function(){return l._translucentMRTClearCommand.color},u_depthTexture:function(){return l._depthStencilTexture}},this._adjustTranslucentCommand=e.createViewportQuadCommand(c,{uniformMap:m,owner:this})):this._translucentMultipassSupport&&(c=new _["a"]({sources:[C["a"]]}),m={u_bgColor:function(){return l._translucentMultipassClearCommand.color},u_depthTexture:function(){return l._depthStencilTexture}},this._adjustTranslucentCommand=e.createViewportQuadCommand(c,{uniformMap:m,owner:this}),m={u_bgColor:function(){return l._alphaClearCommand.color},u_depthTexture:function(){return l._depthStencilTexture}},this._adjustAlphaCommand=e.createViewportQuadCommand(c,{uniformMap:m,owner:this}))),this._viewport.width=s,this._viewport.height=u;var p=!r["a"].equals(this._viewport,t.viewport),g=p!==this._useScissorTest;this._useScissorTest=p,r["a"].equals(this._scissorRectangle,t.viewport)||(this._scissorRectangle=r["a"].clone(t.viewport,this._scissorRectangle),g=!0),Object(o["a"])(this._rs)&&r["a"].equals(this._viewport,this._rs.viewport)&&!g||(this._rs=h["a"].fromCache({viewport:this._viewport,scissorTest:{enabled:this._useScissorTest,rectangle:this._scissorRectangle}})),Object(o["a"])(this._compositeCommand)&&(this._compositeCommand.renderState=this._rs),this._adjustTranslucentCommand&&(this._adjustTranslucentCommand.renderState=this._rs),Object(o["a"])(this._adjustAlphaCommand)&&(this._adjustAlphaCommand.renderState=this._rs)}}};var b={enabled:!0,color:new n["a"](0,0,0,0),equationRgb:g["a"].ADD,equationAlpha:g["a"].ADD,functionSourceRgb:T["a"].ONE,functionDestinationRgb:T["a"].ONE,functionSourceAlpha:T["a"].ZERO,functionDestinationAlpha:T["a"].ONE_MINUS_SOURCE_ALPHA},j={enabled:!0,color:new n["a"](0,0,0,0),equationRgb:g["a"].ADD,equationAlpha:g["a"].ADD,functionSourceRgb:T["a"].ONE,functionDestinationRgb:T["a"].ONE,functionSourceAlpha:T["a"].ONE,functionDestinationAlpha:T["a"].ONE},B={enabled:!0,color:new n["a"](0,0,0,0),equationRgb:g["a"].ADD,equationAlpha:g["a"].ADD,functionSourceRgb:T["a"].ZERO,functionDestinationRgb:T["a"].ONE_MINUS_SOURCE_ALPHA,functionSourceAlpha:T["a"].ZERO,functionDestinationAlpha:T["a"].ONE_MINUS_SOURCE_ALPHA};function A(e,t,a,r){var n=a[r.id];if(!Object(o["a"])(n)){var s=h["a"].getState(r);s.depthMask=!1,s.blending=t,n=h["a"].fromCache(s),a[r.id]=n}return n}function R(e,t,a){return A(t,b,e._translucentRenderStateCache,a)}function D(e,t,a){return A(t,j,e._translucentRenderStateCache,a)}function M(e,t,a){return A(t,B,e._alphaRenderStateCache,a)}var P="    vec3 Ci = czm_gl_FragColor.rgb * czm_gl_FragColor.a;\n    float ai = czm_gl_FragColor.a;\n    float wzi = czm_alphaWeight(ai);\n    gl_FragData[0] = vec4(Ci * wzi, ai);\n    gl_FragData[1] = vec4(ai * wzi);\n",y="    vec3 Ci = czm_gl_FragColor.rgb * czm_gl_FragColor.a;\n    float ai = czm_gl_FragColor.a;\n    float wzi = czm_alphaWeight(ai);\n    gl_FragColor = vec4(Ci, ai) * wzi;\n",q="    float ai = czm_gl_FragColor.a;\n    gl_FragColor = vec4(ai);\n";function z(e,t,a,r){var n=e.shaderCache.getDerivedShaderProgram(t,a);if(!Object(o["a"])(n)){var s=t._attributeLocations,u=t.fragmentShaderSource.clone();u.sources=u.sources.map((function(e){return e=_["a"].replaceMain(e,"czm_translucent_main"),e=e.replace(/gl_FragColor/g,"czm_gl_FragColor"),e=e.replace(/\bdiscard\b/g,"czm_discard = true"),e=e.replace(/czm_phong/g,"czm_translucentPhong"),e})),u.sources.splice(0,0,(-1!==r.indexOf("gl_FragData")?"#extension GL_EXT_draw_buffers : enable \n":"")+"vec4 czm_gl_FragColor;\nbool czm_discard = false;\n"),u.sources.push("void main()\n{\n    czm_translucent_main();\n    if (czm_discard)\n    {\n        discard;\n    }\n"+r+"}\n"),n=e.shaderCache.createDerivedShaderProgram(t,a,{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:u,attributeLocations:s})}return n}function E(e,t){return z(e,t,"translucentMRT",P)}function N(e,t){return z(e,t,"translucentMultipass",y)}function L(e,t){return z(e,t,"alphaMultipass",q)}function I(e,t,a,r,n,s){var u,i,d,c=t.context,m=t.frameState.useLogDepth,l=t._hdr,h=r.framebuffer,_=n.length,p=t.frameState.shadowState.lightShadowsEnabled;r.framebuffer=e._adjustTranslucentFBO,e._adjustTranslucentCommand.execute(c,r),r.framebuffer=e._adjustAlphaFBO,e._adjustAlphaCommand.execute(c,r);var C=e._opaqueFBO;for(r.framebuffer=e._translucentFBO,d=0;d<_;++d)u=n[d],u=m?u.derivedCommands.logDepth.command:u,u=l?u.derivedCommands.hdr.command:u,i=p&&u.receiveShadows?u.derivedCommands.oit.shadows.translucentCommand:u.derivedCommands.oit.translucentCommand,a(i,t,c,r,C);for(Object(o["a"])(s)&&(u=s.unclassifiedCommand,i=p&&u.receiveShadows?u.derivedCommands.oit.shadows.translucentCommand:u.derivedCommands.oit.translucentCommand,a(i,t,c,r,C)),r.framebuffer=e._alphaFBO,d=0;d<_;++d)u=n[d],u=m?u.derivedCommands.logDepth.command:u,u=l?u.derivedCommands.hdr.command:u,i=p&&u.receiveShadows?u.derivedCommands.oit.shadows.alphaCommand:u.derivedCommands.oit.alphaCommand,a(i,t,c,r,C);Object(o["a"])(s)&&(u=s.unclassifiedCommand,i=p&&u.receiveShadows?u.derivedCommands.oit.shadows.alphaCommand:u.derivedCommands.oit.alphaCommand,a(i,t,c,r,C)),r.framebuffer=h}function U(e,t,a,r,n,s){var u=t.context,i=t.frameState.useLogDepth,d=t._hdr,c=r.framebuffer,m=n.length,l=t.frameState.shadowState.lightShadowsEnabled;r.framebuffer=e._adjustTranslucentFBO,e._adjustTranslucentCommand.execute(u,r);var h,_,p=e._opaqueFBO;r.framebuffer=e._translucentFBO;for(var C=0;C<m;++C)h=n[C],h=i?h.derivedCommands.logDepth.command:h,h=d?h.derivedCommands.hdr.command:h,_=l&&h.receiveShadows?h.derivedCommands.oit.shadows.translucentCommand:h.derivedCommands.oit.translucentCommand,a(_,t,u,r,p);Object(o["a"])(s)&&(h=s.unclassifiedCommand,_=l&&h.receiveShadows?h.derivedCommands.oit.shadows.translucentCommand:h.derivedCommands.oit.translucentCommand,a(_,t,u,r,p)),r.framebuffer=c}v.prototype.createDerivedCommands=function(e,t,a){var r,n,s,u,i,d;(Object(o["a"])(a)||(a={}),this._translucentMRTSupport)?(Object(o["a"])(a.translucentCommand)&&(r=a.translucentCommand.shaderProgram,n=a.translucentCommand.renderState),a.translucentCommand=c["a"].shallowClone(e,a.translucentCommand),Object(o["a"])(r)&&a.shaderProgramId===e.shaderProgram.id?(a.translucentCommand.shaderProgram=r,a.translucentCommand.renderState=n):(a.translucentCommand.shaderProgram=E(t,e.shaderProgram),a.translucentCommand.renderState=R(this,t,e.renderState),a.shaderProgramId=e.shaderProgram.id)):(Object(o["a"])(a.translucentCommand)&&(s=a.translucentCommand.shaderProgram,u=a.translucentCommand.renderState,i=a.alphaCommand.shaderProgram,d=a.alphaCommand.renderState),a.translucentCommand=c["a"].shallowClone(e,a.translucentCommand),a.alphaCommand=c["a"].shallowClone(e,a.alphaCommand),Object(o["a"])(s)&&a.shaderProgramId===e.shaderProgram.id?(a.translucentCommand.shaderProgram=s,a.translucentCommand.renderState=u,a.alphaCommand.shaderProgram=i,a.alphaCommand.renderState=d):(a.translucentCommand.shaderProgram=N(t,e.shaderProgram),a.translucentCommand.renderState=D(this,t,e.renderState),a.alphaCommand.shaderProgram=L(t,e.shaderProgram),a.alphaCommand.renderState=M(this,t,e.renderState),a.shaderProgramId=e.shaderProgram.id));return a},v.prototype.executeCommands=function(e,t,a,r,n){this._translucentMRTSupport?U(this,e,t,a,r,n):I(this,e,t,a,r,n)},v.prototype.execute=function(e,t){this._compositeCommand.execute(e,t)},v.prototype.clear=function(e,t,a){var r=t.framebuffer;t.framebuffer=this._opaqueFBO,n["a"].clone(a,this._opaqueClearCommand.color),this._opaqueClearCommand.execute(e,t),t.framebuffer=this._translucentFBO;var o=this._translucentMRTSupport?this._translucentMRTClearCommand:this._translucentMultipassClearCommand;o.execute(e,t),this._translucentMultipassSupport&&(t.framebuffer=this._alphaFBO,this._alphaClearCommand.execute(e,t)),t.framebuffer=r},v.prototype.isSupported=function(){return this._translucentMRTSupport||this._translucentMultipassSupport},v.prototype.isDestroyed=function(){return!1},v.prototype.destroy=function(){return w(this),Object(o["a"])(this._compositeCommand)&&(this._compositeCommand.shaderProgram=this._compositeCommand.shaderProgram&&this._compositeCommand.shaderProgram.destroy()),Object(o["a"])(this._adjustTranslucentCommand)&&(this._adjustTranslucentCommand.shaderProgram=this._adjustTranslucentCommand.shaderProgram&&this._adjustTranslucentCommand.shaderProgram.destroy()),Object(o["a"])(this._adjustAlphaCommand)&&(this._adjustAlphaCommand.shaderProgram=this._adjustAlphaCommand.shaderProgram&&this._adjustAlphaCommand.shaderProgram.destroy()),Object(s["a"])(this)},t["a"]=v}}]);