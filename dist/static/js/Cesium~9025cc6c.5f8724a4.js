(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Cesium~9025cc6c"],{"059a":function(e,t,i){"use strict";var a=i("be18"),r=i("bef8"),o=i("2f63"),n=i("7d62"),s=i("55f9"),u=i("93da"),c=i("52f0"),m=i("713f"),d=i("c34a"),h=i("4e1a"),p=i("2ac3"),l=i("1863"),f=i("2f48"),_=i("f806"),g=i("9dbf"),v=i("a307");function b(e){this._scene=e,this._currentTweens=[],this._morphHandler=void 0,this._morphCancelled=!1,this._completeMorph=void 0,this._morphToOrthographic=!1}b.prototype.completeMorph=function(){Object(o["a"])(this._completeMorph)&&this._completeMorph()},b.prototype.morphTo2D=function(e,t){Object(o["a"])(this._completeMorph)&&this._completeMorph();var i=this._scene;this._previousMode=i.mode,this._morphToOrthographic=i.camera.frustum instanceof m["a"],this._previousMode!==v["a"].SCENE2D&&this._previousMode!==v["a"].MORPHING&&(this._scene.morphStart.raiseEvent(this,this._previousMode,v["a"].SCENE2D,!0),i._mode=v["a"].MORPHING,i.camera._setTransform(c["a"].IDENTITY),this._previousMode===v["a"].COLUMBUS_VIEW?pe(this,e):we(this,e,t),0===e&&Object(o["a"])(this._completeMorph)&&this._completeMorph())};var C=new a["a"],w=new a["a"],S=new a["a"],T=new a["a"],y=new a["a"],D=new a["a"],O=new a["a"],E=new r["a"],x=new c["a"],P=new h["a"],R=new m["a"],I={position:void 0,direction:void 0,up:void 0,position2D:void 0,direction2D:void 0,up2D:void 0,frustum:void 0};b.prototype.morphToColumbusView=function(e,t){Object(o["a"])(this._completeMorph)&&this._completeMorph();var i=this._scene;if(this._previousMode=i.mode,this._previousMode!==v["a"].COLUMBUS_VIEW&&this._previousMode!==v["a"].MORPHING){this._scene.morphStart.raiseEvent(this,this._previousMode,v["a"].COLUMBUS_VIEW,!0),i.camera._setTransform(c["a"].IDENTITY);var r,n=C,s=w,m=S;if(e>0)n.x=0,n.y=-1,n.z=1,n=a["a"].multiplyByScalar(a["a"].normalize(n,n),5*t.maximumRadius,n),a["a"].negate(a["a"].normalize(n,s),s),a["a"].cross(a["a"].UNIT_X,s,m);else{var d=i.camera;if(this._previousMode===v["a"].SCENE2D)a["a"].clone(d.position,n),n.z=d.frustum.right-d.frustum.left,a["a"].negate(a["a"].UNIT_Z,s),a["a"].clone(a["a"].UNIT_Y,m);else{a["a"].clone(d.positionWC,n),a["a"].clone(d.directionWC,s),a["a"].clone(d.upWC,m);var h=t.scaleToGeodeticSurface(n,O),p=_["a"].eastNorthUpToFixedFrame(h,t,x);c["a"].inverseTransformation(p,p),i.mapProjection.project(t.cartesianToCartographic(n,E),n),c["a"].multiplyByPointAsVector(p,s,s),c["a"].multiplyByPointAsVector(p,m,m)}}this._morphToOrthographic?(r=R,r.width=i.camera.frustum.right-i.camera.frustum.left,r.aspectRatio=i.drawingBufferWidth/i.drawingBufferHeight):(r=P,r.aspectRatio=i.drawingBufferWidth/i.drawingBufferHeight,r.fov=u["a"].toRadians(60));var l=I;l.position=n,l.direction=s,l.up=m,l.frustum=r;var f=xe(l);j(this,f),this._previousMode===v["a"].SCENE2D?Te(this,e,l,f):(l.position2D=c["a"].multiplyByPoint(g["a"].TRANSFORM_2D,n,T),l.direction2D=c["a"].multiplyByPointAsVector(g["a"].TRANSFORM_2D,s,y),l.up2D=c["a"].multiplyByPointAsVector(g["a"].TRANSFORM_2D,m,D),i._mode=v["a"].MORPHING,ye(this,e,l,f)),0===e&&Object(o["a"])(this._completeMorph)&&this._completeMorph()}};var M={position:new a["a"],direction:new a["a"],up:new a["a"],frustum:void 0},F=new h["a"];function j(e,t){if(e._scene.completeMorphOnUserInput){e._morphHandler=new l["a"](e._scene.canvas);var i=function(){e._morphCancelled=!0,e._scene.camera.cancelFlight(),t(e)};e._completeMorph=i,e._morphHandler.setInputAction(i,f["a"].LEFT_DOWN),e._morphHandler.setInputAction(i,f["a"].MIDDLE_DOWN),e._morphHandler.setInputAction(i,f["a"].RIGHT_DOWN),e._morphHandler.setInputAction(i,f["a"].WHEEL)}}function N(e){for(var t=e._currentTweens,i=0;i<t.length;++i)t[i].cancelTween();e._currentTweens.length=0,e._morphHandler=e._morphHandler&&e._morphHandler.destroy()}b.prototype.morphTo3D=function(e,t){Object(o["a"])(this._completeMorph)&&this._completeMorph();var i=this._scene;if(this._previousMode=i.mode,this._previousMode!==v["a"].SCENE3D&&this._previousMode!==v["a"].MORPHING){if(this._scene.morphStart.raiseEvent(this,this._previousMode,v["a"].SCENE3D,!0),i._mode=v["a"].MORPHING,i.camera._setTransform(c["a"].IDENTITY),this._previousMode===v["a"].SCENE2D)ee(this,e,t);else{var r,n;e>0?(r=M,a["a"].fromDegrees(0,0,5*t.maximumRadius,t,r.position),a["a"].negate(r.position,r.direction),a["a"].normalize(r.direction,r.direction),a["a"].clone(a["a"].UNIT_Z,r.up)):r=k(this,t);var s=i.camera;s.frustum instanceof m["a"]?n=s.frustum.clone():(n=F,n.aspectRatio=i.drawingBufferWidth/i.drawingBufferHeight,n.fov=u["a"].toRadians(60)),r.frustum=n;var d=Oe(r);j(this,d),q(this,e,r,d)}0===e&&Object(o["a"])(this._completeMorph)&&this._completeMorph()}},b.prototype.isDestroyed=function(){return!1},b.prototype.destroy=function(){return N(this),Object(n["a"])(this)};var L=new r["a"],A=new a["a"],V=new c["a"];function k(e,t){var i=e._scene,a=i.camera,r=M,o=r.position,n=r.direction,s=r.up,u=i.mapProjection.unproject(a.position,L);t.cartographicToCartesian(u,o);var m=t.scaleToGeodeticSurface(o,A),d=_["a"].eastNorthUpToFixedFrame(m,t,V);return c["a"].multiplyByPointAsVector(d,a.direction,n),c["a"].multiplyByPointAsVector(d,a.up,s),r}var B=new a["a"],W=new a["a"],U=new a["a"],G=new a["a"],H=new a["a"],z=new a["a"];function q(e,t,i,r){t*=.5;var o=e._scene,n=o.camera,u=a["a"].clone(n.position,B),m=a["a"].clone(n.direction,W),d=a["a"].clone(n.up,U),h=c["a"].multiplyByPoint(g["a"].TRANSFORM_2D_INVERSE,i.position,G),p=c["a"].multiplyByPointAsVector(g["a"].TRANSFORM_2D_INVERSE,i.direction,H),l=c["a"].multiplyByPointAsVector(g["a"].TRANSFORM_2D_INVERSE,i.up,z);function f(e){te(u,h,e.time,n.position),te(m,p,e.time,n.direction),te(d,l,e.time,n.up),a["a"].cross(n.direction,n.up,n.right),a["a"].normalize(n.right,n.right)}var _=o.tweens.add({duration:t,easingFunction:s["a"].QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:f,complete:function(){De(e,o,0,1,t,r)}});e._currentTweens.push(_)}var Q=new m["a"],Y=new a["a"],Z=new a["a"],K=new a["a"],J=new a["a"],X=new a["a"],$=new a["a"];function ee(e,t,i){t/=3;var r,o,n=e._scene,s=n.camera;t>0?(r=M,a["a"].fromDegrees(0,0,5*i.maximumRadius,i,r.position),a["a"].negate(r.position,r.direction),a["a"].normalize(r.direction,r.direction),a["a"].clone(a["a"].UNIT_Z,r.up)):(s.position.z=s.frustum.right-s.frustum.left,r=k(e,i)),e._morphToOrthographic?(o=Q,o.aspectRatio=n.drawingBufferWidth/n.drawingBufferHeight,o.width=s.frustum.right-s.frustum.left):(o=F,o.aspectRatio=n.drawingBufferWidth/n.drawingBufferHeight,o.fov=u["a"].toRadians(60)),r.frustum=o;var c,m=Oe(r);j(e,m),c=e._morphToOrthographic?function(){q(e,t,r,m)}:function(){Se(e,t,r,(function(){q(e,t,r,m)}))},t>0?(n._mode=v["a"].SCENE2D,s.flyTo({duration:t,destination:a["a"].fromDegrees(0,0,5*i.maximumRadius,i,J),complete:function(){n._mode=v["a"].MORPHING,c()}})):c()}function te(e,t,i,r){return a["a"].lerp(e,t,i,r)}function ie(e,t,i,a,r){var o=e._scene,n=o.camera;if(!(n.frustum instanceof m["a"])){var c=n.frustum.fov,d=.5*u["a"].RADIANS_PER_DEGREE,h=i.position.z*Math.tan(.5*c);n.frustum.far=h/Math.tan(.5*d)+1e7;var p=o.tweens.add({duration:t,easingFunction:s["a"].QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:l,complete:function(){n.frustum=i.frustum.clone(),r(e)}});e._currentTweens.push(p)}function l(e){n.frustum.fov=u["a"].lerp(c,d,e.time);var t=h/Math.tan(.5*n.frustum.fov);a(n,t)}}var ae=new a["a"],re=new a["a"],oe=new a["a"],ne=new a["a"],se=new a["a"],ue=new a["a"],ce=new d["a"],me=new p["a"],de=new a["a"],he={position:void 0,direction:void 0,up:void 0,frustum:void 0};function pe(e,t){t*=.5;var i=e._scene,r=i.camera,n=a["a"].clone(r.position,ae),u=a["a"].clone(r.direction,re),m=a["a"].clone(r.up,oe),d=a["a"].negate(a["a"].UNIT_Z,se),h=a["a"].clone(a["a"].UNIT_Y,ue),p=ne;if(t>0)a["a"].clone(a["a"].ZERO,ne),p.z=5*i.mapProjection.ellipsoid.maximumRadius;else{a["a"].clone(n,ne);var l=me;c["a"].multiplyByPoint(g["a"].TRANSFORM_2D,n,l.origin),c["a"].multiplyByPointAsVector(g["a"].TRANSFORM_2D,u,l.direction);var f=i.globe;if(Object(o["a"])(f)){var _=f.pickWorldCoordinates(l,i,!0,de);Object(o["a"])(_)&&(c["a"].multiplyByPoint(g["a"].TRANSFORM_2D_INVERSE,_,p),p.z+=a["a"].distance(n,p))}}var v=ce;v.right=.5*p.z,v.left=-v.right,v.top=v.right*(i.drawingBufferHeight/i.drawingBufferWidth),v.bottom=-v.top;var b=he;b.position=p,b.direction=d,b.up=h,b.frustum=v;var C=Ee(b);function w(e){te(n,p,e.time,r.position),te(u,d,e.time,r.direction),te(m,h,e.time,r.up),a["a"].cross(r.direction,r.up,r.right),a["a"].normalize(r.right,r.right),r._adjustOrthographicFrustum(!0)}function S(e,t){e.position.z=t}j(e,C);var T=i.tweens.add({duration:t,easingFunction:s["a"].QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:w,complete:function(){ie(e,t,b,S,C)}});e._currentTweens.push(T)}var le=new r["a"],fe={position:new a["a"],direction:new a["a"],up:new a["a"],position2D:new a["a"],direction2D:new a["a"],up2D:new a["a"],frustum:new d["a"]},_e={position:new a["a"],direction:new a["a"],up:new a["a"],frustum:void 0},ge=new a["a"],ve=new p["a"],be=new c["a"],Ce=new a["a"];function we(e,t,i){t*=.5;var r=e._scene,n=r.camera,s=fe;if(t>0)a["a"].clone(a["a"].ZERO,s.position),s.position.z=5*i.maximumRadius,a["a"].negate(a["a"].UNIT_Z,s.direction),a["a"].clone(a["a"].UNIT_Y,s.up);else{i.cartesianToCartographic(n.positionWC,le),r.mapProjection.project(le,s.position),a["a"].negate(a["a"].UNIT_Z,s.direction),a["a"].clone(a["a"].UNIT_Y,s.up);var u=ve;a["a"].clone(s.position2D,u.origin);var m=a["a"].clone(n.directionWC,u.direction),d=i.scaleToGeodeticSurface(n.positionWC,Ce),h=_["a"].eastNorthUpToFixedFrame(d,i,be);c["a"].inverseTransformation(h,h),c["a"].multiplyByPointAsVector(h,m,m),c["a"].multiplyByPointAsVector(g["a"].TRANSFORM_2D,m,m);var p=r.globe;if(Object(o["a"])(p)){var l=p.pickWorldCoordinates(u,r,!0,ge);if(Object(o["a"])(l)){var f=a["a"].distance(s.position2D,l);l.x+=f,a["a"].clone(l,s.position2D)}}}function v(e,t){e.position.x=t}c["a"].multiplyByPoint(g["a"].TRANSFORM_2D,s.position,s.position2D),c["a"].multiplyByPointAsVector(g["a"].TRANSFORM_2D,s.direction,s.direction2D),c["a"].multiplyByPointAsVector(g["a"].TRANSFORM_2D,s.up,s.up2D);var b=s.frustum;b.right=.5*s.position.z,b.left=-b.right,b.top=b.right*(r.drawingBufferHeight/r.drawingBufferWidth),b.bottom=-b.top;var C=_e;c["a"].multiplyByPoint(g["a"].TRANSFORM_2D_INVERSE,s.position2D,C.position),a["a"].clone(s.direction,C.direction),a["a"].clone(s.up,C.up),C.frustum=b;var w=Ee(C);function S(){ie(e,t,s,v,w)}j(e,w),ye(e,t,s,S)}function Se(e,t,i,a){var r=e._scene,o=r.camera,n=o.frustum.right-o.frustum.left;o.frustum=i.frustum.clone();var c=o.frustum.fov,m=.5*u["a"].RADIANS_PER_DEGREE,d=n*Math.tan(.5*c);function h(e){o.frustum.fov=u["a"].lerp(m,c,e.time),o.position.z=d/Math.tan(.5*o.frustum.fov)}o.frustum.far=d/Math.tan(.5*m)+1e7,o.frustum.fov=m;var p=r.tweens.add({duration:t,easingFunction:s["a"].QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:h,complete:function(){a(e)}});e._currentTweens.push(p)}function Te(e,t,i,r){t*=.5;var o=e._scene,n=o.camera,u=a["a"].clone(i.position,J),c=a["a"].clone(i.direction,X),m=a["a"].clone(i.up,$);function d(){n.frustum=i.frustum.clone();var d=a["a"].clone(n.position,Y),h=a["a"].clone(n.direction,Z),p=a["a"].clone(n.up,K);function l(e){te(d,u,e.time,n.position),te(h,c,e.time,n.direction),te(p,m,e.time,n.up),a["a"].cross(n.direction,n.up,n.right),a["a"].normalize(n.right,n.right)}d.z=u.z;var f=o.tweens.add({duration:t,easingFunction:s["a"].QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:l,complete:function(){r(e)}});e._currentTweens.push(f)}o._mode=v["a"].MORPHING,e._morphToOrthographic?d():Se(e,0,i,d)}function ye(e,t,i,r){var o=e._scene,n=o.camera,u=a["a"].clone(n.position,Y),c=a["a"].clone(n.direction,Z),m=a["a"].clone(n.up,K),d=a["a"].clone(i.position2D,J),h=a["a"].clone(i.direction2D,X),p=a["a"].clone(i.up2D,$);function l(e){te(u,d,e.time,n.position),te(c,h,e.time,n.direction),te(m,p,e.time,n.up),a["a"].cross(n.direction,n.up,n.right),a["a"].normalize(n.right,n.right),n._adjustOrthographicFrustum(!0)}var f=o.tweens.add({duration:t,easingFunction:s["a"].QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:l,complete:function(){De(e,o,1,0,t,r)}});e._currentTweens.push(f)}function De(e,t,i,a,r,n){var u={object:t,property:"morphTime",startValue:i,stopValue:a,duration:r,easingFunction:s["a"].QUARTIC_OUT};Object(o["a"])(n)&&(u.complete=function(){n(e)});var c=t.tweens.addProperty(u);e._currentTweens.push(c)}function Oe(e){return function(t){var i=t._scene;i._mode=v["a"].SCENE3D,i.morphTime=v["a"].getMorphTime(v["a"].SCENE3D),N(t);var r=i.camera;(t._previousMode!==v["a"].MORPHING||t._morphCancelled)&&(t._morphCancelled=!1,a["a"].clone(e.position,r.position),a["a"].clone(e.direction,r.direction),a["a"].clone(e.up,r.up),a["a"].cross(r.direction,r.up,r.right),a["a"].normalize(r.right,r.right),r.frustum=e.frustum.clone());var n=r.frustum;i.frameState.useLogDepth&&(n.near=.1,n.far=1e10);var s=Object(o["a"])(t._completeMorph);t._completeMorph=void 0,i.camera.update(i.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,v["a"].SCENE3D,s)}}function Ee(e){return function(t){var i=t._scene;i._mode=v["a"].SCENE2D,i.morphTime=v["a"].getMorphTime(v["a"].SCENE2D),N(t);var r=i.camera;a["a"].clone(e.position,r.position),r.position.z=2*i.mapProjection.ellipsoid.maximumRadius,a["a"].clone(e.direction,r.direction),a["a"].clone(e.up,r.up),a["a"].cross(r.direction,r.up,r.right),a["a"].normalize(r.right,r.right),r.frustum=e.frustum.clone();var n=Object(o["a"])(t._completeMorph);t._completeMorph=void 0,i.camera.update(i.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,v["a"].SCENE2D,n)}}function xe(e){return function(t){var i=t._scene;i._mode=v["a"].COLUMBUS_VIEW,i.morphTime=v["a"].getMorphTime(v["a"].COLUMBUS_VIEW),N(t);var r=i.camera;(t._previousModeMode!==v["a"].MORPHING||t._morphCancelled)&&(t._morphCancelled=!1,a["a"].clone(e.position,r.position),a["a"].clone(e.direction,r.direction),a["a"].clone(e.up,r.up),a["a"].cross(r.direction,r.up,r.right),a["a"].normalize(r.right,r.right));var n=r.frustum;i.frameState.useLogDepth&&(n.near=.1,n.far=1e10);var s=Object(o["a"])(t._completeMorph);t._completeMorph=void 0,i.camera.update(i.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,v["a"].COLUMBUS_VIEW,s)}}t["a"]=b},"0c80":function(e,t,i){"use strict";var a=i("77af"),r=i("670c"),o=i("be18"),n=i("a561"),s=i("bef8"),u=i("2f63"),c=i("93da"),m=i("52f0"),d=i("713f"),h=i("c34a"),p=i("f806"),l=i("a307"),f={},_=new n["a"](0,0,0,1),g=new n["a"],v=new a["a"],b=new r["a"],C=new r["a"];f.wgs84ToWindowCoordinates=function(e,t,i){return f.wgs84WithEyeOffsetToWindowCoordinates(e,t,o["a"].ZERO,i)};var w=new n["a"],S=new o["a"];function T(e,t,i,a){var r=i.viewMatrix,s=m["a"].multiplyByVector(r,n["a"].fromElements(e.x,e.y,e.z,1,w),w),u=o["a"].multiplyComponents(t,o["a"].normalize(s,S),S);return s.x+=t.x+u.x,s.y+=t.y+u.y,s.z+=u.z,m["a"].multiplyByVector(i.frustum.projectionMatrix,s,a)}var y=new s["a"](Math.PI,c["a"].PI_OVER_TWO),D=new o["a"],O=new o["a"];f.wgs84WithEyeOffsetToWindowCoordinates=function(e,t,i,a){var n=e.frameState,s=f.computeActualWgs84Position(n,t,_);if(Object(u["a"])(s)){var w=e.canvas,S=v;S.x=0,S.y=0,S.width=w.clientWidth,S.height=w.clientHeight;var E=e.camera,x=!1;if(n.mode===l["a"].SCENE2D){var P=e.mapProjection,R=y,I=P.project(R,D),M=o["a"].clone(E.position,O),F=E.frustum.clone(),j=m["a"].computeViewportTransformation(S,0,1,new m["a"]),N=E.frustum.projectionMatrix,L=E.positionWC.y,A=o["a"].fromElements(c["a"].sign(L)*I.x-L,0,-E.positionWC.x),V=p["a"].pointToGLWindowCoordinates(N,j,A);if(0===L||V.x<=0||V.x>=w.clientWidth)x=!0;else{if(V.x>.5*w.clientWidth){S.width=V.x,E.frustum.right=I.x-L,g=T(s,i,E,g),f.clipToGLWindowCoordinates(S,g,b),S.x+=V.x,E.position.x=-E.position.x;var k=E.frustum.right;E.frustum.right=-E.frustum.left,E.frustum.left=-k,g=T(s,i,E,g),f.clipToGLWindowCoordinates(S,g,C)}else{S.x+=V.x,S.width-=V.x,E.frustum.left=-I.x-L,g=T(s,i,E,g),f.clipToGLWindowCoordinates(S,g,b),S.x=S.x-S.width,E.position.x=-E.position.x;var B=E.frustum.left;E.frustum.left=-E.frustum.right,E.frustum.right=-B,g=T(s,i,E,g),f.clipToGLWindowCoordinates(S,g,C)}o["a"].clone(M,E.position),E.frustum=F.clone(),a=r["a"].clone(b,a),(a.x<0||a.x>w.clientWidth)&&(a.x=C.x)}}if(n.mode!==l["a"].SCENE2D||x){if(g=T(s,i,E,g),g.z<0&&!(E.frustum instanceof d["a"])&&!(E.frustum instanceof h["a"]))return;a=f.clipToGLWindowCoordinates(S,g,a)}return a.y=w.clientHeight-a.y,a}},f.wgs84ToDrawingBufferCoordinates=function(e,t,i){if(i=f.wgs84ToWindowCoordinates(e,t,i),Object(u["a"])(i))return f.transformWindowToDrawingBuffer(e,i,i)};var E=new o["a"],x=new s["a"];f.computeActualWgs84Position=function(e,t,i){var a=e.mode;if(a===l["a"].SCENE3D)return o["a"].clone(t,i);var r=e.mapProjection,n=r.ellipsoid.cartesianToCartographic(t,x);if(Object(u["a"])(n)){if(r.project(n,E),a===l["a"].COLUMBUS_VIEW)return o["a"].fromElements(E.z,E.x,E.y,i);if(a===l["a"].SCENE2D)return o["a"].fromElements(0,E.x,E.y,i);var s=e.morphTime;return o["a"].fromElements(c["a"].lerp(E.z,t.x,s),c["a"].lerp(E.x,t.y,s),c["a"].lerp(E.y,t.z,s),i)}};var P=new o["a"],R=new o["a"],I=new m["a"];f.clipToGLWindowCoordinates=function(e,t,i){return o["a"].divideByScalar(t,t.w,P),m["a"].computeViewportTransformation(e,0,1,I),m["a"].multiplyByPoint(I,P,R),r["a"].fromCartesian3(R,i)},f.transformWindowToDrawingBuffer=function(e,t,i){var a=e.canvas,o=e.drawingBufferWidth/a.clientWidth,n=e.drawingBufferHeight/a.clientHeight;return r["a"].fromElements(t.x*o,t.y*n,i)};var M=new n["a"],F=new n["a"];f.drawingBufferToWgs84Coordinates=function(e,t,i,a){var r=e.context,s=r.uniformState,c=s.currentFrustum,d=c.x,h=c.y;if(e.frameState.useLogDepth){var p=i*s.log2FarDepthFromNearPlusOne,l=Math.pow(2,p)-1;i=h*(1-d/(l+d))/(h-d)}var f,_=e.view.passState.viewport,g=n["a"].clone(n["a"].UNIT_W,M);g.x=(t.x-_.x)/_.width*2-1,g.y=(t.y-_.y)/_.height*2-1,g.z=2*i-1,g.w=1;var v=e.camera.frustum;if(Object(u["a"])(v.fovy)){f=m["a"].multiplyByVector(s.inverseViewProjection,g,F);var b=1/f.w;o["a"].multiplyByScalar(f,b,f)}else Object(u["a"])(v._offCenterFrustum)&&(v=v._offCenterFrustum),f=F,f.x=.5*(g.x*(v.right-v.left)+v.left+v.right),f.y=.5*(g.y*(v.top-v.bottom)+v.bottom+v.top),f.z=.5*(g.z*(d-h)-d-h),f.w=1,f=m["a"].multiplyByVector(s.inverseView,f,f);return o["a"].fromCartesian4(f,a)},t["a"]=f},"7fe1":function(e,t,i){"use strict";var a=i("bd8d"),r=i("2f63"),o=i("7d62"),n=i("e42d"),s=i("f845"),u=i("ac3b"),c=i("6ef5"),m=i("8a65"),d=i("3550"),h=i("6c84"),p=i("a913");function l(){this._colorTexture=void 0,this._idTexture=void 0,this._depthStencilTexture=void 0,this._depthStencilRenderbuffer=void 0,this._framebuffer=void 0,this._idFramebuffer=void 0,this._idClearColor=new a["a"](0,0,0,0),this._useHdr=void 0,this._clearCommand=new s["a"]({color:new a["a"](0,0,0,0),depth:1,owner:this})}function f(e){e._framebuffer=e._framebuffer&&e._framebuffer.destroy(),e._idFramebuffer=e._idFramebuffer&&e._idFramebuffer.destroy(),e._colorTexture=e._colorTexture&&e._colorTexture.destroy(),e._idTexture=e._idTexture&&e._idTexture.destroy(),e._depthStencilTexture=e._depthStencilTexture&&e._depthStencilTexture.destroy(),e._depthStencilRenderbuffer=e._depthStencilRenderbuffer&&e._depthStencilRenderbuffer.destroy(),e._depthStencilIdTexture=e._depthStencilIdTexture&&e._depthStencilIdTexture.destroy(),e._depthStencilIdRenderbuffer=e._depthStencilIdRenderbuffer&&e._depthStencilIdRenderbuffer.destroy(),e._framebuffer=void 0,e._idFramebuffer=void 0,e._colorTexture=void 0,e._idTexture=void 0,e._depthStencilTexture=void 0,e._depthStencilRenderbuffer=void 0,e._depthStencilIdTexture=void 0,e._depthStencilIdRenderbuffer=void 0}l.prototype.update=function(e,t,i){var a=t.width,o=t.height,s=this._colorTexture;if(!Object(r["a"])(s)||s.width!==a||s.height!==o||i!==this._useHdr){f(this),this._useHdr=i;var l=i?e.halfFloatingPointTexture?c["a"].HALF_FLOAT:c["a"].FLOAT:c["a"].UNSIGNED_BYTE;this._colorTexture=new p["a"]({context:e,width:a,height:o,pixelFormat:n["a"].RGBA,pixelDatatype:l,sampler:h["a"].NEAREST}),this._idTexture=new p["a"]({context:e,width:a,height:o,pixelFormat:n["a"].RGBA,pixelDatatype:c["a"].UNSIGNED_BYTE,sampler:h["a"].NEAREST}),e.depthTexture?(this._depthStencilTexture=new p["a"]({context:e,width:a,height:o,pixelFormat:n["a"].DEPTH_STENCIL,pixelDatatype:c["a"].UNSIGNED_INT_24_8,sampler:h["a"].NEAREST}),this._depthStencilIdTexture=new p["a"]({context:e,width:a,height:o,pixelFormat:n["a"].DEPTH_STENCIL,pixelDatatype:c["a"].UNSIGNED_INT_24_8,sampler:h["a"].NEAREST})):(this._depthStencilRenderbuffer=new m["a"]({context:e,width:a,height:o,format:d["a"].DEPTH_STENCIL}),this._depthStencilIdRenderbuffer=new m["a"]({context:e,width:a,height:o,format:d["a"].DEPTH_STENCIL})),this._framebuffer=new u["a"]({context:e,colorTextures:[this._colorTexture],depthStencilTexture:this._depthStencilTexture,depthStencilRenderbuffer:this._depthStencilRenderbuffer,destroyAttachments:!1}),this._idFramebuffer=new u["a"]({context:e,colorTextures:[this._idTexture],depthStencilTexture:this._depthStencilIdTexture,depthStencilRenderbuffer:this._depthStencilIdRenderbuffer,destroyAttachments:!1})}},l.prototype.clear=function(e,t,i){var r=t.framebuffer;t.framebuffer=this._framebuffer,a["a"].clone(i,this._clearCommand.color),this._clearCommand.execute(e,t),t.framebuffer=this._idFramebuffer,a["a"].clone(this._idClearColor,this._clearCommand.color),this._clearCommand.execute(e,t),t.framebuffer=r},l.prototype.getFramebuffer=function(){return this._framebuffer},l.prototype.getIdFramebuffer=function(){return this._idFramebuffer},l.prototype.isDestroyed=function(){return!1},l.prototype.destroy=function(){return f(this),Object(o["a"])(this)},t["a"]=l},a307:function(e,t,i){"use strict";var a={MORPHING:0,COLUMBUS_VIEW:1,SCENE2D:2,SCENE3D:3,getMorphTime:function(e){return e===a.SCENE3D?1:e!==a.MORPHING?0:void 0}};t["a"]=Object.freeze(a)},da97:function(e,t,i){"use strict";var a=i("77af"),r=i("cef5"),o=i("b482"),n=i("be18"),s=i("bef8"),u=i("dc1c"),c=i("bd8d"),m=i("9541"),d=i("71ce"),h=i("2384"),p=i("535a"),l=i("2f63"),f=i("7d62"),_=i("6cae"),g=i("21d7"),v=i("3d7f"),b=i("d9403"),C=i("c1e2"),w=i("66bf"),S=i("5ed2"),T=i("93da"),y=i("52f0"),D=i("4b0f"),O=i("f0be"),E=i("713f"),x=i("c34a"),P=i("4e1a"),R=i("4dc8"),I=i("75b2"),M=i("6a29"),F=i("f806"),j=i("f845"),N=i("aec5"),L=i("de02"),A=i("b997"),V=i("d289"),k=i("6dc0"),B=i("1331"),W=i("9dbf"),U=i("d150"),G=i("56d3"),H=i("0b8f"),z=i("c965"),q=i("81e1"),Q=i("ed8b"),Y=i("9cff"),Z=i("0838"),K=i("f3b8"),J=i("6f08"),X=i("6b72"),$=i("d57b"),ee=i("4436"),te=i("482f"),ie=i("1b40"),ae=i("01c0"),re=i("3a8e"),oe=i("d572"),ne=i("9e4a"),se=i("894b"),ue=i("738d"),ce=i("a307"),me=i("0c80"),de=i("059a"),he=i("59d5"),pe=i("569f"),le=i("3626"),fe=i("e065"),_e=i("cdd6"),ge=i("619f"),ve=i("ef77"),be=i("8e47"),Ce=function(e){return function(){e.frameState.afterRender.push((function(){e.requestRender()}))}};function we(e){e=Object(p["a"])(e,p["a"].EMPTY_OBJECT);var t=e.canvas,i=e.creditContainer,r=e.creditViewport,o=Object(u["a"])(e.contextOptions);Object(l["a"])(o)||(o={}),Object(l["a"])(o.webgl)||(o.webgl={}),o.webgl.powerPreference=Object(p["a"])(o.webgl.powerPreference,"high-performance");var n=Object(l["a"])(i),s=new L["a"](t,o);n||(i=document.createElement("div"),i.style.position="absolute",i.style.bottom="0",i.style["text-shadow"]="0 0 2px #000000",i.style.color="#ffffff",i.style["font-size"]="10px",i.style["padding-right"]="5px",t.parentNode.appendChild(i)),Object(l["a"])(r)||(r=t.parentNode),this._id=Object(d["a"])(),this._jobScheduler=new ee["a"],this._frameState=new K["a"](s,new H["a"](i," • ",r),this._jobScheduler),this._frameState.scene3DOnly=Object(p["a"])(e.scene3DOnly,!1),this._removeCreditContainer=!n,this._creditContainer=i,this._canvas=t,this._context=s,this._computeEngine=new N["a"](s),this._globe=void 0,this._globeTranslucencyState=new X["a"],this._primitives=new ue["a"],this._groundPrimitives=new ue["a"],this._globeHeight=void 0,this._cameraUnderground=!1,this._logDepthBuffer=s.fragmentDepth,this._logDepthBufferDirty=!0,this._tweens=new ge["a"],this._shaderFrameCount=0,this._sunPostProcess=void 0,this._computeCommandList=[],this._overlayCommandList=[],this._useOIT=Object(p["a"])(e.orderIndependentTranslucency,!0),this._executeOITFunction=void 0,this._depthPlane=new q["a"],this._clearColorCommand=new j["a"]({color:new c["a"],stencil:0,owner:this}),this._depthClearCommand=new j["a"]({depth:1,owner:this}),this._stencilClearCommand=new j["a"]({stencil:0}),this._classificationStencilClearCommand=new j["a"]({stencil:0,renderState:k["a"].fromCache({stencilMask:le["a"].CLASSIFICATION_MASK})}),this._depthOnlyRenderStateCache={},this._transitioner=new de["a"](this),this._preUpdate=new g["a"],this._postUpdate=new g["a"],this._renderError=new g["a"],this._preRender=new g["a"],this._postRender=new g["a"],this._minimumDisableDepthTestDistance=0,this._debugInspector=new be["a"],this.rethrowRenderErrors=!1,this.completeMorphOnUserInput=!0,this.morphStart=new g["a"],this.morphComplete=new g["a"],this.skyBox=void 0,this.skyAtmosphere=void 0,this.sun=void 0,this.sunBloom=!0,this._sunBloom=void 0,this.moon=void 0,this.backgroundColor=c["a"].clone(c["a"].BLACK),this._mode=ce["a"].SCENE3D,this._mapProjection=Object(l["a"])(e.mapProjection)?e.mapProjection:new v["a"],this.morphTime=1,this.farToNearRatio=1e3,this.logarithmicDepthFarToNearRatio=1e9,this.nearToFarDistance2D=175e4,this.debugCommandFilter=void 0,this.debugShowCommands=!1,this.debugShowFrustums=!1,this.debugShowFramesPerSecond=!1,this.debugShowGlobeDepth=!1,this.debugShowDepthFrustum=1,this.debugShowFrustumPlanes=!1,this._debugShowFrustumPlanes=!1,this._debugFrustumPlanes=void 0,this.useDepthPicking=!0,this.pickTranslucentDepth=!1,this.cameraEventWaitTime=500,this.fog=new Z["a"],this._shadowMapCamera=new W["a"](this),this.shadowMap=new pe["a"]({context:s,lightCamera:this._shadowMapCamera,enabled:Object(p["a"])(e.shadows,!1)}),this.invertClassification=!1,this.invertClassificationColor=c["a"].clone(c["a"].WHITE),this._actualInvertClassificationColor=c["a"].clone(this._invertClassificationColor),this._invertClassification=new $["a"],this.focalLength=void 0,this.eyeSeparation=void 0,this.postProcessStages=new ne["a"],this._brdfLutGenerator=new B["a"],this._terrainExaggeration=Object(p["a"])(e.terrainExaggeration,1),this._performanceDisplay=void 0,this._debugVolume=void 0,this._screenSpaceCameraController=new he["a"](this),this._cameraUnderground=!1,this._mapMode2D=Object(p["a"])(e.mapMode2D,te["a"].INFINITE_SCROLL),this._environmentState={skyBoxCommand:void 0,skyAtmosphereCommand:void 0,sunDrawCommand:void 0,sunComputeCommand:void 0,moonCommand:void 0,isSunVisible:!1,isMoonVisible:!1,isReadyForAtmosphere:!1,isSkyAtmosphereVisible:!1,clearGlobeDepth:!1,useDepthPlane:!1,renderTranslucentDepthForPick:!1,originalFramebuffer:void 0,useGlobeDepthFramebuffer:!1,separatePrimitiveFramebuffer:!1,useOIT:!1,useInvertClassification:!1,usePostProcess:!1,usePostProcessSelected:!1,useWebVR:!1},this._useWebVR=!1,this._cameraVR=void 0,this._aspectRatioVR=void 0,this.requestRenderMode=Object(p["a"])(e.requestRenderMode,!1),this._renderRequested=!0,this.maximumRenderTimeChange=Object(p["a"])(e.maximumRenderTimeChange,0),this._lastRenderTime=void 0,this._frameRateMonitor=void 0,this._removeRequestListenerCallback=I["a"].requestCompletedEvent.addEventListener(Ce(this)),this._removeTaskProcessorListenerCallback=M["a"].taskCompletedEvent.addEventListener(Ce(this)),this._removeGlobeCallbacks=[];var m=new a["a"](0,0,s.drawingBufferWidth,s.drawingBufferHeight),h=new W["a"](this);this._logDepthBuffer&&(h.frustum.near=.1,h.frustum.far=1e10),this.preloadFlightCamera=new W["a"](this),this.preloadFlightCullingVolume=void 0,this._picking=new oe["a"](this),this._defaultView=new ve["a"](this,h,m),this._view=this._defaultView,this._hdr=void 0,this._hdrDirty=void 0,this.highDynamicRange=!1,this.gamma=2.2,this.sphericalHarmonicCoefficients=void 0,this.specularEnvironmentMaps=void 0,this._specularEnvironmentMapAtlas=void 0,this.light=new fe["a"],Ie(this,0,S["a"].now()),this.updateFrameState(),this.initializeFrame()}function Se(e,t){for(var i=0;i<e._removeGlobeCallbacks.length;++i)e._removeGlobeCallbacks[i]();e._removeGlobeCallbacks.length=0;var a=[];Object(l["a"])(t)&&(a.push(t.imageryLayersUpdatedEvent.addEventListener(Ce(e))),a.push(t.terrainProviderChanged.addEventListener(Ce(e)))),e._removeGlobeCallbacks=a}function Te(e,t,i){var a=e._frameState,r=e._context,o=e._view.oit,n=a.shadowState.lightShadowMaps,s=a.shadowState.lightShadowsEnabled,u=t.derivedCommands;Object(l["a"])(t.pickId)&&(u.picking=Q["a"].createPickDerivedCommand(e,t,r,u.picking)),t.pickOnly||(u.depth=Q["a"].createDepthOnlyDerivedCommand(e,t,r,u.depth)),u.originalCommand=t,e._hdr&&(u.hdr=Q["a"].createHdrCommand(t,r,u.hdr),t=u.hdr.command,u=t.derivedCommands),s&&t.receiveShadows&&(u.shadows=pe["a"].createReceiveDerivedCommand(n,t,i,r,u.shadows)),t.pass===V["a"].TRANSLUCENT&&Object(l["a"])(o)&&o.isSupported()&&(s&&t.receiveShadows?(u.oit=Object(l["a"])(u.oit)?u.oit:{},u.oit.shadows=o.createDerivedCommands(u.shadows.receiveCommand,r,u.oit.shadows)):u.oit=o.createDerivedCommands(t,r,u.oit))}Object.defineProperties(we.prototype,{canvas:{get:function(){return this._canvas}},drawingBufferHeight:{get:function(){return this._context.drawingBufferHeight}},drawingBufferWidth:{get:function(){return this._context.drawingBufferWidth}},maximumAliasedLineWidth:{get:function(){return A["a"].maximumAliasedLineWidth}},maximumCubeMapSize:{get:function(){return A["a"].maximumCubeMapSize}},pickPositionSupported:{get:function(){return this._context.depthTexture}},sampleHeightSupported:{get:function(){return this._context.depthTexture}},clampToHeightSupported:{get:function(){return this._context.depthTexture}},invertClassificationSupported:{get:function(){return this._context.depthTexture}},specularEnvironmentMapsSupported:{get:function(){return ie["a"].isSupported(this._context)}},globe:{get:function(){return this._globe},set:function(e){this._globe=this._globe&&this._globe.destroy(),this._globe=e,Se(this,e)}},primitives:{get:function(){return this._primitives}},groundPrimitives:{get:function(){return this._groundPrimitives}},camera:{get:function(){return this._view.camera},set:function(e){this._view.camera=e}},view:{get:function(){return this._view},set:function(e){this._view=e}},defaultView:{get:function(){return this._defaultView}},picking:{get:function(){return this._picking}},screenSpaceCameraController:{get:function(){return this._screenSpaceCameraController}},mapProjection:{get:function(){return this._mapProjection}},jobScheduler:{get:function(){return this._jobScheduler}},frameState:{get:function(){return this._frameState}},environmentState:{get:function(){return this._environmentState}},tweens:{get:function(){return this._tweens}},imageryLayers:{get:function(){if(Object(l["a"])(this.globe))return this.globe.imageryLayers}},terrainProvider:{get:function(){if(Object(l["a"])(this.globe))return this.globe.terrainProvider},set:function(e){Object(l["a"])(this.globe)&&(this.globe.terrainProvider=e)}},terrainProviderChanged:{get:function(){if(Object(l["a"])(this.globe))return this.globe.terrainProviderChanged}},preUpdate:{get:function(){return this._preUpdate}},postUpdate:{get:function(){return this._postUpdate}},renderError:{get:function(){return this._renderError}},preRender:{get:function(){return this._preRender}},postRender:{get:function(){return this._postRender}},lastRenderTime:{get:function(){return this._lastRenderTime}},context:{get:function(){return this._context}},debugFrustumStatistics:{get:function(){return this._view.debugFrustumStatistics}},scene3DOnly:{get:function(){return this._frameState.scene3DOnly}},orderIndependentTranslucency:{get:function(){return this._useOIT}},id:{get:function(){return this._id}},mode:{get:function(){return this._mode},set:function(e){e===ce["a"].SCENE2D?this.morphTo2D(0):e===ce["a"].SCENE3D?this.morphTo3D(0):e===ce["a"].COLUMBUS_VIEW&&this.morphToColumbusView(0),this._mode=e}},frustumCommandsList:{get:function(){return this._view.frustumCommandsList}},numberOfFrustums:{get:function(){return this._view.frustumCommandsList.length}},terrainExaggeration:{get:function(){return this._terrainExaggeration}},useWebVR:{get:function(){return this._useWebVR},set:function(e){this._useWebVR=e,this._useWebVR?(this._frameState.creditDisplay.container.style.visibility="hidden",this._cameraVR=new W["a"](this),Object(l["a"])(this._deviceOrientationCameraController)||(this._deviceOrientationCameraController=new Y["a"](this)),this._aspectRatioVR=this.camera.frustum.aspectRatio):(this._frameState.creditDisplay.container.style.visibility="visible",this._cameraVR=void 0,this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy(),this.camera.frustum.aspectRatio=this._aspectRatioVR,this.camera.frustum.xOffset=0)}},mapMode2D:{get:function(){return this._mapMode2D}},imagerySplitPosition:{get:function(){return this._frameState.imagerySplitPosition},set:function(e){this._frameState.imagerySplitPosition=e}},minimumDisableDepthTestDistance:{get:function(){return this._minimumDisableDepthTestDistance},set:function(e){this._minimumDisableDepthTestDistance=e}},logarithmicDepthBuffer:{get:function(){return this._logDepthBuffer},set:function(e){e=this._context.fragmentDepth&&e,this._logDepthBuffer!==e&&(this._logDepthBuffer=e,this._logDepthBufferDirty=!0)}},gamma:{get:function(){return this._context.uniformState.gamma},set:function(e){this._context.uniformState.gamma=e}},highDynamicRange:{get:function(){return this._hdr},set:function(e){var t=this._context,i=e&&t.depthTexture&&(t.colorBufferFloat||t.colorBufferHalfFloat);this._hdrDirty=i!==this._hdr,this._hdr=i}},highDynamicRangeSupported:{get:function(){var e=this._context;return e.depthTexture&&(e.colorBufferFloat||e.colorBufferHalfFloat)}},cameraUnderground:{get:function(){return this._cameraUnderground}},pixelRatio:{get:function(){return this._frameState.pixelRatio},set:function(e){this._frameState.pixelRatio=e}},opaqueFrustumNearOffset:{get:function(){return.9999}},globeHeight:{get:function(){return this._globeHeight}}}),we.prototype.getCompressedTextureFormatSupported=function(e){var t=this.context;return("WEBGL_compressed_texture_s3tc"===e||"s3tc"===e)&&t.s3tc||("WEBGL_compressed_texture_pvrtc"===e||"pvrtc"===e)&&t.pvrtc||("WEBGL_compressed_texture_etc1"===e||"etc1"===e)&&t.etc1},we.prototype.updateDerivedCommands=function(e){if(Object(l["a"])(e.derivedCommands)){var t=this._frameState,i=this._context,a=!1,r=t.shadowState.lastDirtyTime;e.lastDirtyTime!==r&&(e.lastDirtyTime=r,e.dirty=!0,a=!0);var o=t.useLogDepth,n=this._hdr,s=e.derivedCommands,u=Object(l["a"])(s.logDepth),c=Object(l["a"])(s.hdr),m=Object(l["a"])(s.originalCommand),d=o&&!u,h=n&&!c,p=(!o||!n)&&!m;if(e.dirty=e.dirty||d||h||p,e.dirty){e.dirty=!1;var f=t.shadowState.shadowMaps,_=t.shadowState.shadowsEnabled;_&&e.castShadows&&(s.shadows=pe["a"].createCastDerivedCommand(f,e,a,i,s.shadows)),(u||d)&&(s.logDepth=Q["a"].createLogDepthCommand(e,i,s.logDepth),Te(this,s.logDepth.command,a)),(m||p)&&Te(this,e,a)}}};var ye,De=new G["a"]({pass:U["a"].RENDER}),Oe=new G["a"]({pass:U["a"].PRELOAD}),Ee=new G["a"]({pass:U["a"].PRELOAD_FLIGHT}),xe=new G["a"]({pass:U["a"].REQUEST_RENDER_MODE_DEFER_CHECK}),Pe=new r["a"];function Re(e){var t=e.globe;if(e._mode===ce["a"].SCENE3D&&Object(l["a"])(t)&&t.show&&!e._cameraUnderground&&!e._globeTranslucencyState.translucent){var i=t.ellipsoid,a=e.frameState.minimumTerrainHeight;return Pe.radius=i.minimumRadius+a,ye=O["a"].fromBoundingSphere(Pe,e.camera.positionWC,ye),ye}}function Ie(e,t,i){var a=e._frameState;a.frameNumber=t,a.time=S["a"].clone(i,a.time)}we.prototype.clearPasses=function(e){e.render=!1,e.pick=!1,e.depth=!1,e.postProcess=!1,e.offscreen=!1},we.prototype.updateFrameState=function(){var e=this.camera,t=this._frameState;t.commandList.length=0,t.shadowMaps.length=0,t.brdfLutGenerator=this._brdfLutGenerator,t.environmentMap=this.skyBox&&this.skyBox._cubeMap,t.mode=this._mode,t.morphTime=this.morphTime,t.mapProjection=this.mapProjection,t.camera=e,t.cullingVolume=e.frustum.computeCullingVolume(e.positionWC,e.directionWC,e.upWC),t.occluder=Re(this),t.terrainExaggeration=this._terrainExaggeration,t.minimumTerrainHeight=0,t.minimumDisableDepthTestDistance=this._minimumDisableDepthTestDistance,t.invertClassification=this.invertClassification,t.useLogDepth=this._logDepthBuffer&&!(this.camera.frustum instanceof E["a"]||this.camera.frustum instanceof x["a"]),t.light=this.light,t.cameraUnderground=this._cameraUnderground,t.globeTranslucencyState=this._globeTranslucencyState,Object(l["a"])(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.ready?(t.specularEnvironmentMaps=this._specularEnvironmentMapAtlas.texture,t.specularEnvironmentMapsMaximumLOD=this._specularEnvironmentMapAtlas.maximumMipmapLevel):(t.specularEnvironmentMaps=void 0,t.specularEnvironmentMapsMaximumLOD=void 0),t.sphericalHarmonicCoefficients=this.sphericalHarmonicCoefficients,this._actualInvertClassificationColor=c["a"].clone(this.invertClassificationColor,this._actualInvertClassificationColor),$["a"].isTranslucencySupported(this._context)||(this._actualInvertClassificationColor.alpha=1),t.invertClassificationColor=this._actualInvertClassificationColor,Object(l["a"])(this.globe)?t.maximumScreenSpaceError=this.globe.maximumScreenSpaceError:t.maximumScreenSpaceError=2,this.clearPasses(t.passes),t.tilesetPassState=void 0},we.prototype.isVisible=function(e,t,i){return Object(l["a"])(e)&&(!Object(l["a"])(e.boundingVolume)||!e.cull||t.computeVisibility(e.boundingVolume)!==w["a"].OUTSIDE&&(!Object(l["a"])(i)||!e.occlude||!e.boundingVolume.isOccluded(i)))};var Me=new y["a"](0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1);function Fe(e,t,i,a){var r,s=t._frameState,u=s.context,c=e.boundingVolume;Object(l["a"])(t._debugVolume)&&t._debugVolume.destroy();var d=n["a"].clone(c.center);if(s.mode!==ce["a"].SCENE3D){d=y["a"].multiplyByPoint(Me,d,d);var h=s.mapProjection,p=h.unproject(d);d=h.ellipsoid.cartographicToCartesian(p)}if(Object(l["a"])(c.radius)){var f=c.radius;r=C["a"].toWireframe(_["a"].createGeometry(new _["a"]({radii:new n["a"](f,f,f),vertexFormat:re["a"].FLAT_VERTEX_FORMAT}))),t._debugVolume=new se["a"]({geometryInstances:new b["a"]({geometry:r,modelMatrix:y["a"].fromTranslation(d),attributes:{color:new m["a"](1,0,0,1)}}),appearance:new re["a"]({flat:!0,translucent:!1}),asynchronous:!1})}else{var g=c.halfAxes;r=C["a"].toWireframe(o["a"].createGeometry(o["a"].fromDimensions({dimensions:new n["a"](2,2,2),vertexFormat:re["a"].FLAT_VERTEX_FORMAT}))),t._debugVolume=new se["a"]({geometryInstances:new b["a"]({geometry:r,modelMatrix:y["a"].fromRotationTranslation(g,d,new y["a"]),attributes:{color:new m["a"](1,0,0,1)}}),appearance:new re["a"]({flat:!0,translucent:!1}),asynchronous:!1})}var v,w=s.commandList,S=s.commandList=[];if(t._debugVolume.update(s),e=S[0],s.useLogDepth){var T=Q["a"].createLogDepthCommand(e,u);e=T.command}Object(l["a"])(a)&&(v=i.framebuffer,i.framebuffer=a),e.execute(u,i),Object(l["a"])(v)&&(i.framebuffer=v),s.commandList=w}function je(e,t,i,a,r){var o=t._frameState;if(!Object(l["a"])(t.debugCommandFilter)||t.debugCommandFilter(e))if(e instanceof j["a"])e.execute(i,a);else{e.debugShowBoundingVolume&&Object(l["a"])(e.boundingVolume)&&Fe(e,t,a,r),o.useLogDepth&&Object(l["a"])(e.derivedCommands.logDepth)&&(e=e.derivedCommands.logDepth.command);var n=o.passes;if(!n.pick&&!n.depth&&t._hdr&&Object(l["a"])(e.derivedCommands)&&Object(l["a"])(e.derivedCommands.hdr)&&(e=e.derivedCommands.hdr.command),n.pick||n.depth){if(n.pick&&!n.depth&&Object(l["a"])(e.derivedCommands.picking))return e=e.derivedCommands.picking.pickCommand,void e.execute(i,a);if(Object(l["a"])(e.derivedCommands.depth))return e=e.derivedCommands.depth.depthOnlyCommand,void e.execute(i,a)}t.debugShowCommands||t.debugShowFrustums?t._debugInspector.executeDebugShowFrustumsCommand(t,e,a):o.shadowState.lightShadowsEnabled&&e.receiveShadows&&Object(l["a"])(e.derivedCommands.shadows)?e.derivedCommands.shadows.receiveCommand.execute(i,a):e.execute(i,a)}}function Ne(e,t,i,a){var r=t._frameState,o=e.derivedCommands;Object(l["a"])(o)&&(r.useLogDepth&&Object(l["a"])(o.logDepth)&&(e=o.logDepth.command),o=e.derivedCommands,Object(l["a"])(o.picking)?(e=o.picking.pickCommand,e.execute(i,a)):Object(l["a"])(o.depth)&&(e=o.depth.depthOnlyCommand,e.execute(i,a)))}function Le(e,t,i){return t.boundingVolume.distanceSquaredTo(i)-e.boundingVolume.distanceSquaredTo(i)}function Ae(e,t,i){return e.boundingVolume.distanceSquaredTo(i)-t.boundingVolume.distanceSquaredTo(i)+T["a"].EPSILON12}function Ve(e,t,i,a,r){var o=e.context;Object(D["a"])(a,Le,e.camera.positionWC),Object(l["a"])(r)&&t(r.unclassifiedCommand,e,o,i);for(var n=a.length,s=0;s<n;++s)t(a[s],e,o,i)}function ke(e,t,i,a,r){var o=e.context;Object(D["a"])(a,Ae,e.camera.positionWC),Object(l["a"])(r)&&t(r.unclassifiedCommand,e,o,i);for(var n=a.length,s=0;s<n;++s)t(a[s],e,o,i)}function Be(e,t){var i=e._view.debugGlobeDepths,a=i[t];return!Object(l["a"])(a)&&e.context.depthTexture&&(a=new J["a"],i[t]=a),a}Me=y["a"].inverseTransformation(Me,Me);var We=new P["a"],Ue=new R["a"],Ge=new E["a"],He=new x["a"];function ze(e,t){var i,a=e.camera,r=e.context,o=e.frameState,n=r.uniformState;n.updateCamera(a),i=Object(l["a"])(a.frustum.fov)?a.frustum.clone(We):Object(l["a"])(a.frustum.infiniteProjectionMatrix)?a.frustum.clone(Ue):Object(l["a"])(a.frustum.width)?a.frustum.clone(Ge):a.frustum.clone(He),i.near=a.frustum.near,i.far=a.frustum.far,n.updateFrustum(i),n.updatePass(V["a"].ENVIRONMENT);var s,u=o.passes,c=u.pick,m=e._environmentState,d=e._view,h=m.renderTranslucentDepthForPick,p=m.useWebVR;if(!c){var f,_=m.skyBoxCommand;if(Object(l["a"])(_)&&je(_,e,r,t),m.isSkyAtmosphereVisible&&je(m.skyAtmosphereCommand,e,r,t),m.isSunVisible)if(m.sunDrawCommand.execute(r,t),e.sunBloom&&!p)f=m.useGlobeDepthFramebuffer?d.globeDepth.framebuffer:m.usePostProcess?d.sceneFramebuffer.getFramebuffer():m.originalFramebuffer,e._sunPostProcess.execute(r),e._sunPostProcess.copy(r,f),t.framebuffer=f;m.isMoonVisible&&m.moonCommand.execute(r,t)}m.useOIT?(Object(l["a"])(e._executeOITFunction)||(e._executeOITFunction=function(e,t,i,a,r){d.oit.executeCommands(e,t,i,a,r)}),s=e._executeOITFunction):s=u.render?Ve:ke;for(var g,v=d.frustumCommandsList,b=v.length,C=m.clearGlobeDepth,w=m.useDepthPlane,S=e._globeTranslucencyState,T=S.translucent,y=e._view.globeTranslucencyFramebuffer,D=m.separatePrimitiveFramebuffer=!1,O=e._depthClearCommand,E=e._stencilClearCommand,x=e._classificationStencilClearCommand,P=e._depthPlane,R=m.usePostProcessSelected,I=a.position.z,M=0;M<b;++M){var F=b-M-1,j=v[F];e.mode===ce["a"].SCENE2D?(a.position.z=I-j.near+1,i.far=Math.max(1,j.far-j.near),i.near=1,n.update(o),n.updateFrustum(i)):(i.near=0!==F?j.near*e.opaqueFrustumNearOffset:j.near,i.far=j.far,n.updateFrustum(i));var N,L=e.debugShowGlobeDepth?Be(e,F):d.globeDepth;D&&(t.framebuffer=L.framebuffer),e.debugShowGlobeDepth&&Object(l["a"])(L)&&m.useGlobeDepthFramebuffer&&(L.update(r,t,d.viewport,e._hdr,C),L.clear(r,t,e._clearColorCommand.color),N=t.framebuffer,t.framebuffer=L.framebuffer),O.execute(r,t),r.stencilBuffer&&E.execute(r,t),n.updatePass(V["a"].GLOBE);var A,k=j.commands[V["a"].GLOBE],B=j.indices[V["a"].GLOBE];if(T)S.executeGlobeCommands(j,je,y,e,t);else for(g=0;g<B;++g)je(k[g],e,r,t);if(Object(l["a"])(L)&&m.useGlobeDepthFramebuffer&&L.executeCopyDepth(r,t),e.debugShowGlobeDepth&&Object(l["a"])(L)&&m.useGlobeDepthFramebuffer&&(t.framebuffer=N),!m.renderTranslucentDepthForPick)if(n.updatePass(V["a"].TERRAIN_CLASSIFICATION),k=j.commands[V["a"].TERRAIN_CLASSIFICATION],B=j.indices[V["a"].TERRAIN_CLASSIFICATION],T)S.executeGlobeClassificationCommands(j,je,y,e,t);else for(g=0;g<B;++g)je(k[g],e,r,t);if(C&&(O.execute(r,t),w&&P.execute(r,t)),D&&(t.framebuffer=L.primitiveFramebuffer),!m.useInvertClassification||c||m.renderTranslucentDepthForPick){for(n.updatePass(V["a"].CESIUM_3D_TILE),k=j.commands[V["a"].CESIUM_3D_TILE],B=j.indices[V["a"].CESIUM_3D_TILE],g=0;g<B;++g)je(k[g],e,r,t);if(B>0&&(Object(l["a"])(L)&&m.useGlobeDepthFramebuffer&&L.executeUpdateDepth(r,t,C),!m.renderTranslucentDepthForPick))for(n.updatePass(V["a"].CESIUM_3D_TILE_CLASSIFICATION),k=j.commands[V["a"].CESIUM_3D_TILE_CLASSIFICATION],B=j.indices[V["a"].CESIUM_3D_TILE_CLASSIFICATION],g=0;g<B;++g)je(k[g],e,r,t)}else{e._invertClassification.clear(r,t);var W=t.framebuffer;for(t.framebuffer=e._invertClassification._fbo,n.updatePass(V["a"].CESIUM_3D_TILE),k=j.commands[V["a"].CESIUM_3D_TILE],B=j.indices[V["a"].CESIUM_3D_TILE],g=0;g<B;++g)je(k[g],e,r,t);for(Object(l["a"])(L)&&m.useGlobeDepthFramebuffer&&L.executeUpdateDepth(r,t,C),n.updatePass(V["a"].CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW),k=j.commands[V["a"].CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW],B=j.indices[V["a"].CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW],g=0;g<B;++g)je(k[g],e,r,t);for(t.framebuffer=W,e._invertClassification.executeClassified(r,t),1===o.invertClassificationColor.alpha&&e._invertClassification.executeUnclassified(r,t),B>0&&r.stencilBuffer&&x.execute(r,t),n.updatePass(V["a"].CESIUM_3D_TILE_CLASSIFICATION),k=j.commands[V["a"].CESIUM_3D_TILE_CLASSIFICATION],B=j.indices[V["a"].CESIUM_3D_TILE_CLASSIFICATION],g=0;g<B;++g)je(k[g],e,r,t)}for(B>0&&r.stencilBuffer&&E.execute(r,t),n.updatePass(V["a"].OPAQUE),k=j.commands[V["a"].OPAQUE],B=j.indices[V["a"].OPAQUE],g=0;g<B;++g)je(k[g],e,r,t);0!==F&&e.mode!==ce["a"].SCENE2D&&(i.near=j.near,n.updateFrustum(i)),!c&&m.useInvertClassification&&o.invertClassificationColor.alpha<1&&(A=e._invertClassification),n.updatePass(V["a"].TRANSLUCENT),k=j.commands[V["a"].TRANSLUCENT],k.length=j.indices[V["a"].TRANSLUCENT],s(e,je,t,k,A);var U=j.indices[V["a"].CESIUM_3D_TILE_CLASSIFICATION]>0;if(U&&d.translucentTileClassification.isSupported()&&(d.translucentTileClassification.executeTranslucentCommands(e,je,t,k,L.framebuffer),d.translucentTileClassification.executeClassificationCommands(e,je,t,j)),r.depthTexture&&e.useDepthPicking&&(m.useGlobeDepthFramebuffer||h)){var G=h?t.framebuffer.depthStencilTexture:L.framebuffer.depthStencilTexture,H=e._picking.getPickDepth(e,F);H.update(r,G),H.executeCopyDepth(r,t)}if(D&&(t.framebuffer=L.framebuffer),!c&&R){var z=t.framebuffer;if(t.framebuffer=d.sceneFramebuffer.getIdFramebuffer(),i.near=0!==F?j.near*e.opaqueFrustumNearOffset:j.near,i.far=j.far,n.updateFrustum(i),n.updatePass(V["a"].GLOBE),k=j.commands[V["a"].GLOBE],B=j.indices[V["a"].GLOBE],T)S.executeGlobeCommands(j,Ne,y,e,t);else for(g=0;g<B;++g)Ne(k[g],e,r,t);for(C&&(O.framebuffer=t.framebuffer,O.execute(r,t),O.framebuffer=void 0),C&&w&&P.execute(r,t),n.updatePass(V["a"].CESIUM_3D_TILE),k=j.commands[V["a"].CESIUM_3D_TILE],B=j.indices[V["a"].CESIUM_3D_TILE],g=0;g<B;++g)Ne(k[g],e,r,t);for(n.updatePass(V["a"].OPAQUE),k=j.commands[V["a"].OPAQUE],B=j.indices[V["a"].OPAQUE],g=0;g<B;++g)Ne(k[g],e,r,t);for(n.updatePass(V["a"].TRANSLUCENT),k=j.commands[V["a"].TRANSLUCENT],B=j.indices[V["a"].TRANSLUCENT],g=0;g<B;++g)Ne(k[g],e,r,t);t.framebuffer=z}}}function qe(e){var t=e.context.uniformState;t.updatePass(V["a"].COMPUTE);var i=e._environmentState.sunComputeCommand;Object(l["a"])(i)&&i.execute(e._computeEngine);for(var a=e._computeCommandList,r=a.length,o=0;o<r;++o)a[o].execute(e._computeEngine)}function Qe(e,t){var i=e.context.uniformState;i.updatePass(V["a"].OVERLAY);for(var a=e.context,r=e._overlayCommandList,o=r.length,n=0;n<o;++n)r[n].execute(a,t)}function Ye(e,t,i){for(var a=i.shadowMapCullingVolume,r=i.isPointLight,o=i.passes,n=o.length,s=t.length,u=0;u<s;++u){var c=t[u];if(e.updateDerivedCommands(c),c.castShadows&&(c.pass===V["a"].GLOBE||c.pass===V["a"].CESIUM_3D_TILE||c.pass===V["a"].OPAQUE||c.pass===V["a"].TRANSLUCENT)&&e.isVisible(c,a))if(r)for(var m=0;m<n;++m)o[m].commandList.push(c);else if(1===n)o[0].commandList.push(c);else for(var d=!1,h=n-1;h>=0;--h){var p=o[h].cullingVolume;if(e.isVisible(c,p))o[h].commandList.push(c),d=!0;else if(d)break}}}function Ze(e){var t=e.frameState,i=t.shadowState.shadowMaps,a=i.length;if(t.shadowState.shadowsEnabled)for(var r=e.context,o=r.uniformState,n=0;n<a;++n){var s=i[n];if(!s.outOfView){var u,c=s.passes,m=c.length;for(u=0;u<m;++u)c[u].commandList.length=0;var d=e.frameState.commandList;for(Ye(e,d,s),u=0;u<m;++u){var h=s.passes[u];o.updateCamera(h.camera),s.updatePass(r,u);for(var p=h.commandList.length,l=0;l<p;++l){var f=h.commandList[l];o.updatePass(f.pass),je(f.derivedCommands.shadows.castCommands[n],e,r,h.passState)}}}}}var Ke=new n["a"];function Je(e,t,i){var a=e._view,r=a.camera,o=e._environmentState,s=o.renderTranslucentDepthForPick;ht(e,t,i),s||dt(e),a.createPotentiallyVisibleSet(e),s||(qe(e),Ze(e));var u=t.viewport;u.x=0,u.y=0,u.width=.5*u.width;var c=W["a"].clone(r,e._cameraVR);c.frustum=r.frustum;var m=r.frustum.near,d=m*Object(p["a"])(e.focalLength,5),h=Object(p["a"])(e.eyeSeparation,d/30),l=n["a"].multiplyByScalar(c.right,.5*h,Ke);r.frustum.aspectRatio=u.width/u.height;var f=.5*h*m/d;n["a"].add(c.position,l,r.position),r.frustum.xOffset=f,ze(e,t),u.x=u.width,n["a"].subtract(c.position,l,r.position),r.frustum.xOffset=-f,ze(e,t),W["a"].clone(c,r)}we.prototype.updateAndExecuteCommands=function(e,t){var i=this._frameState,a=i.mode,r=this._environmentState.useWebVR;r?Je(this,e,t):a!==ce["a"].SCENE2D||this._mapMode2D===te["a"].ROTATE?st(!0,this,e,t):(ht(this,e,t),nt(this,e))};var Xe=new s["a"](Math.PI,T["a"].PI_OVER_TWO),$e=new n["a"],et=new n["a"],tt=new y["a"],it=new y["a"],at=new n["a"],rt=new n["a"],ot=new a["a"];function nt(e,t){var i=e.context,r=e.frameState,o=e.camera,s=t.viewport,u=a["a"].clone(s,ot);t.viewport=u;var c=Xe,m=$e,d=e.mapProjection;d.project(c,m);var h=n["a"].clone(o.position,et),p=y["a"].clone(o.transform,it),l=o.frustum.clone();o._setTransform(y["a"].IDENTITY);var f=y["a"].computeViewportTransformation(u,0,1,tt),_=o.frustum.projectionMatrix,g=o.positionWC.y,v=n["a"].fromElements(T["a"].sign(g)*m.x-g,0,-o.positionWC.x,at),b=F["a"].pointToGLWindowCoordinates(_,f,v,rt);b.x=Math.floor(b.x);var C=u.x,w=u.width;if(0===g||b.x<=C||b.x>=C+w)st(!0,e,t);else if(Math.abs(C+.5*w-b.x)<1)u.width=b.x-u.x,o.position.x*=T["a"].sign(o.position.x),o.frustum.right=0,r.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(r),st(!0,e,t),u.x=b.x,o.position.x=-o.position.x,o.frustum.right=-o.frustum.left,o.frustum.left=0,r.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(r),st(!1,e,t);else if(b.x>C+.5*w){u.width=b.x-C;var S=o.frustum.right;o.frustum.right=m.x-g,r.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(r),st(!0,e,t),u.x=b.x,u.width=C+w-b.x,o.position.x=-o.position.x,o.frustum.left=-o.frustum.right,o.frustum.right=S-2*o.frustum.right,r.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(r),st(!1,e,t)}else{u.x=b.x,u.width=C+w-b.x;var D=o.frustum.left;o.frustum.left=-m.x-g,r.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(r),st(!0,e,t),u.x=C,u.width=b.x-C,o.position.x=-o.position.x,o.frustum.right=-o.frustum.left,o.frustum.left=D-2*o.frustum.left,r.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(r),st(!1,e,t)}o._setTransform(p),n["a"].clone(h,o.position),o.frustum=l.clone(),t.viewport=s}function st(e,t,i,a){var r=t._environmentState,o=t._view,n=r.renderTranslucentDepthForPick;e||n||(t.frameState.commandList.length=0),n||dt(t),o.createPotentiallyVisibleSet(t),e&&(Object(l["a"])(a)&&ht(t,i,a),n||(qe(t),Ze(t))),ze(t,i)}var ut=new h["a"];function ct(e){var t=e._frameState;e.debugShowFrustumPlanes!==e._debugShowFrustumPlanes&&(e.debugShowFrustumPlanes?e._debugFrustumPlanes=new z["a"]({camera:e.camera,updateOnChange:!1,frustumSplits:t.frustumSplits}):e._debugFrustumPlanes=e._debugFrustumPlanes&&e._debugFrustumPlanes.destroy(),e._debugShowFrustumPlanes=e.debugShowFrustumPlanes),Object(l["a"])(e._debugFrustumPlanes)&&e._debugFrustumPlanes.update(t)}function mt(e){var t=e._frameState,i=t.shadowMaps,a=i.length,r=a>0&&!t.passes.pick&&e.mode===ce["a"].SCENE3D;if(r!==t.shadowState.shadowsEnabled&&(++t.shadowState.lastDirtyTime,t.shadowState.shadowsEnabled=r),t.shadowState.lightShadowsEnabled=!1,r){for(var o=0;o<a;++o)if(i[o]!==t.shadowState.shadowMaps[o]){++t.shadowState.lastDirtyTime;break}t.shadowState.shadowMaps.length=0,t.shadowState.lightShadowMaps.length=0;for(var n=0;n<a;++n){var s=i[n];s.update(t),t.shadowState.shadowMaps.push(s),s.fromLightSource&&(t.shadowState.lightShadowMaps.push(s),t.shadowState.lightShadowsEnabled=!0),s.dirty&&(++t.shadowState.lastDirtyTime,s.dirty=!1)}}}function dt(e){var t=e._frameState;e._groundPrimitives.update(t),e._primitives.update(t),ct(e),mt(e),e._globe&&e._globe.render(t)}function ht(e,t,i){var a=e._context,r=e._frameState,o=e._environmentState,n=e._view,s=e._frameState.passes,u=s.pick,m=o.useWebVR;o.originalFramebuffer=t.framebuffer,Object(l["a"])(e.sun)&&e.sunBloom!==e._sunBloom?(e.sunBloom&&!m?e._sunPostProcess=new _e["a"]:Object(l["a"])(e._sunPostProcess)&&(e._sunPostProcess=e._sunPostProcess.destroy()),e._sunBloom=e.sunBloom):!Object(l["a"])(e.sun)&&Object(l["a"])(e._sunPostProcess)&&(e._sunPostProcess=e._sunPostProcess.destroy(),e._sunBloom=!1);var d=e._clearColorCommand;c["a"].clone(i,d.color),d.execute(a,t);var h=o.useGlobeDepthFramebuffer=Object(l["a"])(n.globeDepth);h&&(n.globeDepth.update(a,t,n.viewport,e._hdr,o.clearGlobeDepth),n.globeDepth.clear(a,t,i));var p=n.oit,f=o.useOIT=!u&&Object(l["a"])(p)&&p.isSupported();f&&(p.update(a,t,n.globeDepth.framebuffer,e._hdr),p.clear(a,t,i),o.useOIT=p.isSupported());var _=e.postProcessStages,g=o.usePostProcess=!u&&(e._hdr||_.length>0||_.ambientOcclusion.enabled||_.fxaa.enabled||_.bloom.enabled);o.usePostProcessSelected=!1,g&&(n.sceneFramebuffer.update(a,n.viewport,e._hdr),n.sceneFramebuffer.clear(a,t,i),_.update(a,r.useLogDepth,e._hdr),_.clear(a),g=o.usePostProcess=_.ready,o.usePostProcessSelected=g&&_.hasSelected),o.isSunVisible&&e.sunBloom&&!m?(t.framebuffer=e._sunPostProcess.update(t),e._sunPostProcess.clear(a,t,i)):h?t.framebuffer=n.globeDepth.framebuffer:g&&(t.framebuffer=n.sceneFramebuffer.getFramebuffer()),Object(l["a"])(t.framebuffer)&&d.execute(a,t);var v,b=o.useInvertClassification=!u&&Object(l["a"])(t.framebuffer)&&e.invertClassification;if(b)if(1===e.frameState.invertClassificationColor.alpha&&o.useGlobeDepthFramebuffer&&(v=n.globeDepth.framebuffer),Object(l["a"])(v)||a.depthTexture){if(e._invertClassification.previousFramebuffer=v,e._invertClassification.update(a),e._invertClassification.clear(a,t),e.frameState.invertClassificationColor.alpha<1&&f){var C=e._invertClassification.unclassifiedCommand,w=C.derivedCommands;w.oit=p.createDerivedCommands(C,a,w.oit)}}else o.useInvertClassification=!1;e._globeTranslucencyState.translucent&&n.globeTranslucencyFramebuffer.updateAndClear(e._hdr,n.viewport,a,t)}function pt(e){for(var t=e._frameState.afterRender,i=0,a=t.length;i<a;++i)t[i](),e.requestRender();t.length=0}function lt(e){var t=e._globe,i=e.camera,a=i.positionCartographic;if(Object(l["a"])(t)&&t.show&&Object(l["a"])(a))return t.getHeight(a)}function ft(e){var t=e.camera,i=e._mode,a=e.globe,r=e._screenSpaceCameraController,o=t.positionCartographic;if(!Object(l["a"])(o))return!1;if(!r.onMap()&&o.height<0)return!0;if(!Object(l["a"])(a)||!a.show||i===ce["a"].SCENE2D||i===ce["a"].MORPHING)return!1;var n=e._globeHeight;return Object(l["a"])(n)&&o.height<n}function _t(e,t){if(e.debugShowFramesPerSecond){if(!Object(l["a"])(e._performanceDisplay)){var i=document.createElement("div");i.className="cesium-performanceDisplay-defaultContainer";var a=e._canvas.parentNode;a.appendChild(i);var r=new ae["a"]({container:i});e._performanceDisplay=r,e._performanceContainer=i}e._performanceDisplay.throttled=e.requestRenderMode,e._performanceDisplay.update(t)}else Object(l["a"])(e._performanceDisplay)&&(e._performanceDisplay=e._performanceDisplay&&e._performanceDisplay.destroy(),e._performanceContainer.parentNode.removeChild(e._performanceContainer))}function gt(e){e._jobScheduler.resetBudgets();var t=e._frameState,i=e.primitives;i.prePassesUpdate(t),Object(l["a"])(e.globe)&&e.globe.update(t),e._picking.update(),t.creditDisplay.update()}function vt(e){var t=e._frameState,i=e.primitives;i.postPassesUpdate(t),I["a"].update()}we.prototype.updateEnvironment=function(){var e=this._frameState,t=this._view,i=this._environmentState,a=e.passes.render,r=e.passes.offscreen,o=this.skyAtmosphere,n=this.globe,s=this._globeTranslucencyState;if(!a||this._mode!==ce["a"].SCENE2D&&t.camera.frustum instanceof E["a"]||!s.environmentVisible)i.skyAtmosphereCommand=void 0,i.skyBoxCommand=void 0,i.sunDrawCommand=void 0,i.sunComputeCommand=void 0,i.moonCommand=void 0;else{Object(l["a"])(o)?(Object(l["a"])(n)&&(o.setDynamicAtmosphereColor(n.enableLighting&&n.dynamicAtmosphereLighting,n.dynamicAtmosphereLightingFromSun),i.isReadyForAtmosphere=i.isReadyForAtmosphere||n._surface._tilesToRender.length>0),i.skyAtmosphereCommand=o.update(e,n),Object(l["a"])(i.skyAtmosphereCommand)&&this.updateDerivedCommands(i.skyAtmosphereCommand)):i.skyAtmosphereCommand=void 0,i.skyBoxCommand=Object(l["a"])(this.skyBox)?this.skyBox.update(e,this._hdr):void 0;var u=Object(l["a"])(this.sun)?this.sun.update(e,t.passState,this._hdr):void 0;i.sunDrawCommand=Object(l["a"])(u)?u.drawCommand:void 0,i.sunComputeCommand=Object(l["a"])(u)?u.computeCommand:void 0,i.moonCommand=Object(l["a"])(this.moon)?this.moon.update(e):void 0}var c=i.clearGlobeDepth=Object(l["a"])(n)&&n.show&&(!n.depthTestAgainstTerrain||this.mode===ce["a"].SCENE2D),m=i.useDepthPlane=c&&this.mode===ce["a"].SCENE3D&&s.useDepthPlane;m&&this._depthPlane.update(e),i.renderTranslucentDepthForPick=!1,i.useWebVR=this._useWebVR&&this.mode!==ce["a"].SCENE2D&&!r;for(var d=e.mode!==ce["a"].SCENE3D||s.sunVisibleThroughGlobe?void 0:e.occluder,h=e.cullingVolume,p=ut.planes,f=0;f<5;++f)p[f]=h.planes[f];h=ut,i.isSkyAtmosphereVisible=Object(l["a"])(i.skyAtmosphereCommand)&&i.isReadyForAtmosphere,i.isSunVisible=this.isVisible(i.sunDrawCommand,h,d),i.isMoonVisible=this.isVisible(i.moonCommand,h,d);var _=this.specularEnvironmentMaps,g=this._specularEnvironmentMapAtlas;!Object(l["a"])(_)||Object(l["a"])(g)&&g.url===_?!Object(l["a"])(_)&&Object(l["a"])(g)&&(g.destroy(),this._specularEnvironmentMapAtlas=void 0):(g=g&&g.destroy(),this._specularEnvironmentMapAtlas=new ie["a"](_)),Object(l["a"])(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.update(e)},we.prototype.resolveFramebuffers=function(e){var t=this._context,i=this._frameState,a=this._environmentState,r=this._view,o=r.globeDepth,n=a.useOIT,s=a.useGlobeDepthFramebuffer,u=a.usePostProcess,c=a.originalFramebuffer,m=s?o.framebuffer:void 0,d=r.sceneFramebuffer.getFramebuffer(),h=r.sceneFramebuffer.getIdFramebuffer();a.separatePrimitiveFramebuffer&&o.executeMergeColor(t,e),n&&(e.framebuffer=u?d:c,r.oit.execute(t,e));var l=r.translucentTileClassification;if(l.hasTranslucentDepth&&l.isSupported()&&l.execute(this,e),u){var f=d;s&&!n&&(f=m);var _=this.postProcessStages,g=f.getColorTexture(0),v=h.getColorTexture(0),b=Object(p["a"])(m,d).depthStencilTexture;_.execute(t,g,b,v),_.copy(t,c)}n||u||!s||(e.framebuffer=c,o.executeCopyColor(t,e));var C=i.useLogDepth;if(this.debugShowGlobeDepth&&s){var w=Be(this,this.debugShowDepthFrustum-1);w.executeDebugGlobeDepth(t,e,C)}if(this.debugShowPickDepth&&s){var S=this._picking.getPickDepth(this,this.debugShowDepthFrustum-1);S.executeDebugPickDepth(t,e,C)}},we.prototype.initializeFrame=function(){120===this._shaderFrameCount++&&(this._shaderFrameCount=0,this._context.shaderCache.destroyReleasedShaderPrograms(),this._context.textureCache.destroyReleasedTextures()),this._tweens.update(),this._globeHeight=lt(this),this._cameraUnderground=ft(this),this._globeTranslucencyState.update(this),this._screenSpaceCameraController.update(),Object(l["a"])(this._deviceOrientationCameraController)&&this._deviceOrientationCameraController.update(),this.camera.update(this._mode),this.camera._updateCameraChanged()};var bt=new c["a"];function Ct(e){var t=e._frameState,i=e.context,r=i.uniformState,o=e._defaultView;e._view=o,e.updateFrameState(),t.passes.render=!0,t.passes.postProcess=e.postProcessStages.hasSelected,t.tilesetPassState=De;var s=Object(p["a"])(e.backgroundColor,c["a"].BLACK);e._hdr&&(s=c["a"].clone(s,bt),s.red=Math.pow(s.red,e.gamma),s.green=Math.pow(s.green,e.gamma),s.blue=Math.pow(s.blue,e.gamma)),t.backgroundColor=s,e.fog.update(t),r.update(t);var u=e.shadowMap;Object(l["a"])(u)&&u.enabled&&(!Object(l["a"])(e.light)||e.light instanceof fe["a"]?n["a"].negate(r.sunDirectionWC,e._shadowMapCamera.direction):n["a"].clone(e.light.direction,e._shadowMapCamera.direction),t.shadowMaps.push(u)),e._computeCommandList.length=0,e._overlayCommandList.length=0;var m=o.viewport;m.x=0,m.y=0,m.width=i.drawingBufferWidth,m.height=i.drawingBufferHeight;var d=o.passState;d.framebuffer=void 0,d.blendingEnabled=void 0,d.scissorTest=void 0,d.viewport=a["a"].clone(m,d.viewport),Object(l["a"])(e.globe)&&e.globe.beginFrame(t),e.updateEnvironment(),e.updateAndExecuteCommands(d,s),e.resolveFramebuffers(d),d.framebuffer=void 0,Qe(e,d),Object(l["a"])(e.globe)&&(e.globe.endFrame(t),e.globe.tilesLoaded||(e._renderRequested=!0)),i.endFrame()}function wt(e,t){try{t(e)}catch(i){if(e._renderError.raiseEvent(e,i),e.rethrowRenderErrors)throw i}}function St(e){return e._picking.updateMostDetailedRayPicks(e)}function Tt(e){var t=e._frameState;Oe.camera=t.camera,Oe.cullingVolume=t.cullingVolume;var i=e.primitives;i.updateForPass(t,Oe)}function yt(e){var t=e._frameState,i=t.camera;if(i.canPreloadFlight()){Ee.camera=e.preloadFlightCamera,Ee.cullingVolume=e.preloadFlightCullingVolume;var a=e.primitives;a.updateForPass(t,Ee)}}function Dt(e){e.primitives.updateForPass(e._frameState,xe)}we.prototype.render=function(e){this._preUpdate.raiseEvent(this,e);var t=this._frameState;t.newFrame=!1,Object(l["a"])(e)||(e=S["a"].now());var i=this._view.checkForCameraUpdates(this),a=!this.requestRenderMode||this._renderRequested||i||this._logDepthBufferDirty||this._hdrDirty||this.mode===ce["a"].MORPHING;if(!a&&Object(l["a"])(this.maximumRenderTimeChange)&&Object(l["a"])(this._lastRenderTime)){var r=Math.abs(S["a"].secondsDifference(this._lastRenderTime,e));a=a||r>this.maximumRenderTimeChange}if(a){this._lastRenderTime=S["a"].clone(e,this._lastRenderTime),this._renderRequested=!1,this._logDepthBufferDirty=!1,this._hdrDirty=!1;var o=T["a"].incrementWrap(t.frameNumber,15e6,1);Ie(this,o,e),t.newFrame=!0}wt(this,gt),this.primitives.show&&(wt(this,St),wt(this,Tt),wt(this,yt),a||wt(this,Dt)),this._postUpdate.raiseEvent(this,e),a&&(this._preRender.raiseEvent(this,e),t.creditDisplay.beginFrame(),wt(this,Ct)),_t(this,a),wt(this,vt),pt(this),a&&(this._postRender.raiseEvent(this,e),t.creditDisplay.endFrame())},we.prototype.forceRender=function(e){this._renderRequested=!0,this.render(e)},we.prototype.requestRender=function(){this._renderRequested=!0},we.prototype.clampLineWidth=function(e){return Math.max(A["a"].minimumAliasedLineWidth,Math.min(e,A["a"].maximumAliasedLineWidth))},we.prototype.pick=function(e,t,i){return this._picking.pick(this,e,t,i)},we.prototype.pickPositionWorldCoordinates=function(e,t){return this._picking.pickPositionWorldCoordinates(this,e,t)},we.prototype.pickPosition=function(e,t){return this._picking.pickPosition(this,e,t)},we.prototype.drillPick=function(e,t,i,a){return this._picking.drillPick(this,e,t,i,a)},we.prototype.pickFromRay=function(e,t,i){return this._picking.pickFromRay(this,e,t,i)},we.prototype.drillPickFromRay=function(e,t,i,a){return this._picking.drillPickFromRay(this,e,t,i,a)},we.prototype.pickFromRayMostDetailed=function(e,t,i){return this._picking.pickFromRayMostDetailed(this,e,t,i)},we.prototype.drillPickFromRayMostDetailed=function(e,t,i,a){return this._picking.drillPickFromRayMostDetailed(this,e,t,i,a)},we.prototype.sampleHeight=function(e,t,i){return this._picking.sampleHeight(this,e,t,i)},we.prototype.clampToHeight=function(e,t,i,a){return this._picking.clampToHeight(this,e,t,i,a)},we.prototype.sampleHeightMostDetailed=function(e,t,i){return this._picking.sampleHeightMostDetailed(this,e,t,i)},we.prototype.clampToHeightMostDetailed=function(e,t,i){return this._picking.clampToHeightMostDetailed(this,e,t,i)},we.prototype.cartesianToCanvasCoordinates=function(e,t){return me["a"].wgs84ToWindowCoordinates(this,e,t)},we.prototype.completeMorph=function(){this._transitioner.completeMorph()},we.prototype.morphTo2D=function(e){var t,i=this.globe;t=Object(l["a"])(i)?i.ellipsoid:this.mapProjection.ellipsoid,e=Object(p["a"])(e,2),this._transitioner.morphTo2D(e,t)},we.prototype.morphToColumbusView=function(e){var t,i=this.globe;t=Object(l["a"])(i)?i.ellipsoid:this.mapProjection.ellipsoid,e=Object(p["a"])(e,2),this._transitioner.morphToColumbusView(e,t)},we.prototype.morphTo3D=function(e){var t,i=this.globe;t=Object(l["a"])(i)?i.ellipsoid:this.mapProjection.ellipsoid,e=Object(p["a"])(e,2),this._transitioner.morphTo3D(e,t)},we.prototype.isDestroyed=function(){return!1},we.prototype.destroy=function(){this._tweens.removeAll(),this._computeEngine=this._computeEngine&&this._computeEngine.destroy(),this._screenSpaceCameraController=this._screenSpaceCameraController&&this._screenSpaceCameraController.destroy(),this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy(),this._primitives=this._primitives&&this._primitives.destroy(),this._groundPrimitives=this._groundPrimitives&&this._groundPrimitives.destroy(),this._globe=this._globe&&this._globe.destroy(),this.skyBox=this.skyBox&&this.skyBox.destroy(),this.skyAtmosphere=this.skyAtmosphere&&this.skyAtmosphere.destroy(),this._debugSphere=this._debugSphere&&this._debugSphere.destroy(),this.sun=this.sun&&this.sun.destroy(),this._sunPostProcess=this._sunPostProcess&&this._sunPostProcess.destroy(),this._depthPlane=this._depthPlane&&this._depthPlane.destroy(),this._transitioner=this._transitioner&&this._transitioner.destroy(),this._debugFrustumPlanes=this._debugFrustumPlanes&&this._debugFrustumPlanes.destroy(),this._brdfLutGenerator=this._brdfLutGenerator&&this._brdfLutGenerator.destroy(),this._picking=this._picking&&this._picking.destroy(),this._defaultView=this._defaultView&&this._defaultView.destroy(),this._view=void 0,this._removeCreditContainer&&this._canvas.parentNode.removeChild(this._creditContainer),this.postProcessStages=this.postProcessStages&&this.postProcessStages.destroy(),this._context=this._context&&this._context.destroy(),this._frameState.creditDisplay=this._frameState.creditDisplay&&this._frameState.creditDisplay.destroy(),Object(l["a"])(this._performanceDisplay)&&(this._performanceDisplay=this._performanceDisplay&&this._performanceDisplay.destroy(),this._performanceContainer.parentNode.removeChild(this._performanceContainer)),this._removeRequestListenerCallback(),this._removeTaskProcessorListenerCallback();for(var e=0;e<this._removeGlobeCallbacks.length;++e)this._removeGlobeCallbacks[e]();return this._removeGlobeCallbacks.length=0,Object(f["a"])(this)},t["a"]=we}}]);